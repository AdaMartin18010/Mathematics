# 03-运算符与注释 | Operators & Comments

## 目录

- [03-运算符与注释 | Operators & Comments](#03-运算符与注释--operators--comments)
  - [目录](#目录)
  - [1. 主题简介 | Topic Introduction](#1-主题简介--topic-introduction)
  - [2. 运算符系统 | Operator System](#2-运算符系统--operator-system)
  - [3. 注释系统 | Comment System](#3-注释系统--comment-system)
  - [4. 代码格式化 | Code Formatting](#4-代码格式化--code-formatting)
  - [5. 代码示例 | Code Examples](#5-代码示例--code-examples)
  - [6. 相关性与本地跳转 | Relevance & Local Navigation](#6-相关性与本地跳转--relevance--local-navigation)

---

## 1. 主题简介 | Topic Introduction

本主题深入探讨Lean语言中的运算符系统、注释语法以及代码格式化规则，为编写清晰、可维护的Lean代码提供基础。

This topic delves into the operator system, comment syntax, and code formatting rules in Lean language, providing the foundation for writing clear and maintainable Lean code.

---

## 2. 运算符系统 | Operator System

### 2.1 算术运算符 | Arithmetic Operators

```lean
-- 基本算术运算符
def arithmetic_example (a b : Nat) : Nat :=
  let sum := a + b        -- 加法
  let difference := a - b  -- 减法
  let product := a * b     -- 乘法
  let quotient := a / b    -- 除法
  let remainder := a % b   -- 取余
  sum + difference + product
```

### 2.2 比较运算符 | Comparison Operators

```lean
-- 比较运算符
def comparison_example (a b : Nat) : Bool :=
  let equal := a = b       -- 相等
  let not_equal := a ≠ b   -- 不等
  let less := a < b        -- 小于
  let less_equal := a ≤ b  -- 小于等于
  let greater := a > b     -- 大于
  let greater_equal := a ≥ b -- 大于等于
  equal && not_equal
```

### 2.3 逻辑运算符 | Logical Operators

```lean
-- 逻辑运算符
def logical_example (p q : Prop) : Prop :=
  let and := p ∧ q         -- 逻辑与
  let or := p ∨ q          -- 逻辑或
  let not := ¬p            -- 逻辑非
  let implies := p → q     -- 蕴含
  let iff := p ↔ q         -- 等价
  and ∧ or
```

### 2.4 位运算符 | Bitwise Operators

```lean
-- 位运算符
def bitwise_example (a b : Nat) : Nat :=
  let and := a &&& b       -- 按位与
  let or := a ||| b        -- 按位或
  let xor := a ^^^ b       -- 按位异或
  let shift_left := a <<< b -- 左移
  let shift_right := a >>> b -- 右移
  and + or
```

### 2.5 函数运算符 | Function Operators

```lean
-- 函数组合运算符
def function_example : Nat → Nat → Nat :=
  let add := λ x y => x + y
  let double := λ x => x * 2
  let composed := double ∘ add  -- 函数组合
  composed

-- 部分应用
def partial_application : Nat → Nat :=
  let add_five := (· + 5)  -- 部分应用语法
  add_five
```

### 2.6 自定义运算符 | Custom Operators

```lean
-- 自定义运算符
infixl:65 " ⊕ " => λ x y => x + y + 1
infixr:70 " ⊗ " => λ x y => x * y * 2

def custom_operator_example (a b c : Nat) : Nat :=
  a ⊕ b ⊗ c  -- 使用自定义运算符
```

---

## 3. 注释系统 | Comment System

### 3.1 单行注释 | Single-line Comments

```lean
-- 这是单行注释
def example : Nat := 1  -- 行尾注释

-- 多行单行注释
-- 第一行注释
-- 第二行注释
-- 第三行注释
def multi_line_comment : Nat := 2
```

### 3.2 文档注释 | Documentation Comments

```lean
/-- 这是文档注释
  可以跨越多行
  用于生成文档 -/
def documented_function (n : Nat) : Nat := n + 1

/-- 计算斐波那契数列的第n项
  参数：
  - n: 要计算的项数
  返回：第n项的值 -/
def fibonacci : Nat → Nat
  | 0 => 0
  | 1 => 1
  | n + 2 => fibonacci n + fibonacci (n + 1)
```

### 3.3 模块注释 | Module Comments

```lean
/-- 数学工具模块
   提供常用的数学函数和定理
   作者：数学团队
   版本：1.0 -/
namespace MathUtils

/-- 计算阶乘
   @param n 输入数字
   @return n的阶乘 -/
def factorial : Nat → Nat
  | 0 => 1
  | n + 1 => (n + 1) * factorial n

end MathUtils
```

### 3.4 定理注释 | Theorem Comments

```lean
/-- 加法交换律
   对于任意自然数a和b，有a + b = b + a
   这是自然数加法的基本性质之一 -/
theorem add_comm (a b : Nat) : a + b = b + a := by
  induction b with
  | zero => rw [Nat.add_zero, Nat.zero_add]
  | succ b ih => 
    rw [Nat.add_succ, Nat.succ_add, ih]
```

---

## 4. 代码格式化 | Code Formatting

### 4.1 缩进规则 | Indentation Rules

```lean
-- 正确的缩进
def well_formatted_function (n : Nat) : Nat :=
  if n ≤ 1 then
    n
  else
    let prev := well_formatted_function (n - 1)
    let prev_prev := well_formatted_function (n - 2)
    prev + prev_prev

-- 模式匹配的缩进
def pattern_match_example : Nat → String :=
  | 0 => "zero"
  | 1 => "one"
  | 2 => "two"
  | _ => "other"
```

### 4.2 行长度与换行 | Line Length & Line Breaks

```lean
-- 长表达式的换行
def long_expression (a b c d e f : Nat) : Nat :=
  a + b + c + 
  d + e + f

-- 函数参数的换行
def function_with_many_parameters
  (param1 : Nat)
  (param2 : String)
  (param3 : Bool)
  (param4 : List Nat) : Nat :=
  param1 + param4.length
```

### 4.3 空格与分隔符 | Spaces & Separators

```lean
-- 运算符周围的空格
def operator_spacing (a b : Nat) : Nat :=
  a + b * c - d / e

-- 函数调用中的空格
def function_call_spacing : Nat :=
  max (min 1 2) (max 3 4)

-- 类型注解中的空格
def type_annotation_spacing (x : Nat) (y : String) : Bool :=
  x > 0 && y.length > 0
```

---

## 5. 代码示例 | Code Examples

### 5.1 完整示例 | Complete Example

```lean
/-- 数学计算工具模块
   提供基本的数学运算和证明 -/
namespace MathCalculator

-- 基本算术运算
def add (a b : Nat) : Nat := a + b
def subtract (a b : Nat) : Nat := a - b
def multiply (a b : Nat) : Nat := a * b

-- 比较运算
def is_greater (a b : Nat) : Bool := a > b
def is_equal (a b : Nat) : Bool := a = b

-- 逻辑运算
def logical_and (p q : Bool) : Bool := p && q
def logical_or (p q : Bool) : Bool := p || q

/-- 计算两个数的最大公约数
   @param a 第一个数
   @param b 第二个数
   @return 最大公约数 -/
def gcd : Nat → Nat → Nat
  | 0, b => b
  | a, 0 => a
  | a, b => 
    if a > b then
      gcd (a % b) b
    else
      gcd a (b % a)

/-- 欧几里得算法正确性证明
   对于任意自然数a和b，gcd a b是a和b的最大公约数 -/
theorem gcd_correct (a b : Nat) : 
  gcd a b ∣ a ∧ gcd a b ∣ b ∧ 
  ∀ d, d ∣ a → d ∣ b → d ∣ gcd a b := by
  -- 证明实现
  sorry

end MathCalculator
```

### 5.2 格式化最佳实践 | Formatting Best Practices

```lean
-- 良好的格式化示例
namespace WellFormattedCode

-- 使用描述性名称
def calculate_fibonacci_number (n : Nat) : Nat :=
  if n ≤ 1 then
    n
  else
    let previous := calculate_fibonacci_number (n - 1)
    let previous_previous := calculate_fibonacci_number (n - 2)
    previous + previous_previous

-- 清晰的类型注解
def process_list 
  (input : List Nat) 
  (predicate : Nat → Bool) 
  (transformer : Nat → Nat) : List Nat :=
  input
    .filter predicate
    .map transformer

-- 良好的注释
/-- 验证输入是否为有效数字
   @param n 要验证的数字
   @return 如果有效返回true，否则返回false -/
def is_valid_number (n : Nat) : Bool :=
  n > 0 && n < 1000

end WellFormattedCode
```

---

## 6. 相关性与本地跳转 | Relevance & Local Navigation

### 6.1 与Analysis目录的关联

- 与形式化方法相关：运算符系统是形式化表达的基础
- 与逻辑系统相关：逻辑运算符体现了形式逻辑结构

### 6.2 与Refactor目录的关联

- 与编程语言设计相关：注释系统影响代码可读性
- 与软件工程相关：代码格式化影响维护效率

### 6.3 本地跳转链接

- [返回上级目录](../01-总览.md)
- [基本语法元素总览](01-总览.md)
- [标识符与关键字](02-标识符与关键字.md)
- [表达式系统](../03-表达式系统/01-总览.md)

---

*最后更新时间：2025年1月*
*版本：1.0*
*状态：已完成*
