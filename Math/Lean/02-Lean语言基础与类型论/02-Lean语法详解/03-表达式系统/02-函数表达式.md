# 02-函数表达式 | Function Expressions

## 目录

- [02-函数表达式 | Function Expressions](#02-函数表达式--function-expressions)
  - [目录](#目录)
  - [1. 主题简介 | Topic Introduction](#1-主题简介--topic-introduction)
  - [2. 函数定义 | Function Definition](#2-函数定义--function-definition)
    - [2.1 基本函数定义 | Basic Function Definition](#21-基本函数定义--basic-function-definition)
    - [2.2 多参数函数 | Multi-parameter Functions](#22-多参数函数--multi-parameter-functions)
    - [2.3 模式匹配函数 | Pattern Matching Functions](#23-模式匹配函数--pattern-matching-functions)
  - [3. Lambda表达式 | Lambda Expressions](#3-lambda表达式--lambda-expressions)
    - [3.1 基本Lambda表达式 | Basic Lambda Expressions](#31-基本lambda表达式--basic-lambda-expressions)
    - [3.2 Lambda表达式的高级用法 | Advanced Lambda Usage](#32-lambda表达式的高级用法--advanced-lambda-usage)
    - [3.3 Lambda表达式的类型推导 | Type Inference in Lambda](#33-lambda表达式的类型推导--type-inference-in-lambda)
  - [4. 高阶函数 | Higher-order Functions](#4-高阶函数--higher-order-functions)
    - [4.1 函数作为参数 | Functions as Parameters](#41-函数作为参数--functions-as-parameters)
    - [4.2 函数作为返回值 | Functions as Return Values](#42-函数作为返回值--functions-as-return-values)
    - [4.3 高阶函数的实际应用 | Practical Applications](#43-高阶函数的实际应用--practical-applications)
  - [5. 函数组合 | Function Composition](#5-函数组合--function-composition)
    - [5.1 基本函数组合 | Basic Function Composition](#51-基本函数组合--basic-function-composition)
    - [5.2 函数组合的数学性质 | Mathematical Properties](#52-函数组合的数学性质--mathematical-properties)
    - [5.3 高级函数组合 | Advanced Function Composition](#53-高级函数组合--advanced-function-composition)
  - [6. 代码示例 | Code Examples](#6-代码示例--code-examples)
    - [6.1 完整示例 | Complete Example](#61-完整示例--complete-example)
    - [6.2 数学函数示例 | Mathematical Function Examples](#62-数学函数示例--mathematical-function-examples)
  - [7. 相关性与本地跳转 | Relevance \& Local Navigation](#7-相关性与本地跳转--relevance--local-navigation)
    - [7.1 与Analysis目录的关联](#71-与analysis目录的关联)
    - [7.2 与Refactor目录的关联](#72-与refactor目录的关联)
    - [7.3 本地跳转链接](#73-本地跳转链接)

---

## 1. 主题简介 | Topic Introduction

本主题深入探讨Lean语言中的函数表达式系统，包括函数定义、lambda表达式、高阶函数和函数组合等核心概念，为理解函数式编程范式提供基础。

This topic delves into the function expression system in Lean language, including function definitions, lambda expressions, higher-order functions, and function composition, providing the foundation for understanding functional programming paradigms.

---

## 2. 函数定义 | Function Definition

### 2.1 基本函数定义 | Basic Function Definition

```lean
-- 简单函数定义
def add (a b : Nat) : Nat := a + b

-- 带类型注解的函数
def multiply : Nat → Nat → Nat := λ a b => a * b

-- 递归函数定义
def factorial : Nat → Nat
  | 0 => 1
  | n + 1 => (n + 1) * factorial n
```

### 2.2 多参数函数 | Multi-parameter Functions

```lean
-- 多个参数
def calculate (x y z : Nat) : Nat := x + y * z

-- 参数类型不同
def process (n : Nat) (s : String) (b : Bool) : String :=
  if b then
    s ++ " " ++ toString n
  else
    toString n ++ " " ++ s

-- 参数默认值（通过模式匹配实现）
def greet (name : String) (greeting : String := "Hello") : String :=
  greeting ++ ", " ++ name ++ "!"
```

### 2.3 模式匹配函数 | Pattern Matching Functions

```lean
-- 列表处理函数
def list_length {α : Type} : List α → Nat
  | [] => 0
  | _ :: xs => 1 + list_length xs

-- 树结构处理
inductive Tree (α : Type)
  | leaf : Tree α
  | node : α → Tree α → Tree α → Tree α

def tree_size {α : Type} : Tree α → Nat
  | Tree.leaf => 0
  | Tree.node _ left right => 1 + tree_size left + tree_size right
```

---

## 3. Lambda表达式 | Lambda Expressions

### 3.1 基本Lambda表达式 | Basic Lambda Expressions

```lean
-- 基本lambda表达式
def lambda_example : Nat → Nat := λ x => x + 1

-- 多参数lambda
def multi_param_lambda : Nat → Nat → Nat := λ x y => x + y

-- 嵌套lambda
def nested_lambda : Nat → Nat → Nat → Nat := 
  λ x => λ y => λ z => x + y + z
```

### 3.2 Lambda表达式的高级用法 | Advanced Lambda Usage

```lean
-- 条件lambda
def conditional_lambda : Nat → Nat := 
  λ x => if x > 0 then x * 2 else 0

-- 模式匹配lambda
def pattern_lambda : List Nat → Nat :=
  λ xs => match xs with
    | [] => 0
    | x :: _ => x

-- 高阶lambda
def higher_order_lambda : (Nat → Nat) → Nat → Nat :=
  λ f => λ x => f (f x)
```

### 3.3 Lambda表达式的类型推导 | Type Inference in Lambda

```lean
-- 类型推导示例
def inferred_lambda := λ x => x + 1  -- 自动推导为 Nat → Nat

-- 显式类型注解
def explicit_lambda : Nat → Nat := λ x => x + 1

-- 泛型lambda
def generic_lambda {α : Type} : α → α := λ x => x
```

---

## 4. 高阶函数 | Higher-order Functions

### 4.1 函数作为参数 | Functions as Parameters

```lean
-- 接受函数作为参数的函数
def apply_function (f : Nat → Nat) (x : Nat) : Nat := f x

-- 多个函数参数
def combine_functions 
  (f : Nat → Nat) 
  (g : Nat → Nat) 
  (x : Nat) : Nat := f (g x)

-- 条件函数应用
def conditional_apply 
  (f g : Nat → Nat) 
  (condition : Nat → Bool) 
  (x : Nat) : Nat :=
  if condition x then f x else g x
```

### 4.2 函数作为返回值 | Functions as Return Values

```lean
-- 返回函数的函数
def create_adder (n : Nat) : Nat → Nat := λ x => x + n

-- 函数工厂
def create_multiplier (factor : Nat) : Nat → Nat := λ x => x * factor

-- 组合函数生成器
def create_composer (f g : Nat → Nat) : Nat → Nat := λ x => f (g x)
```

### 4.3 高阶函数的实际应用 | Practical Applications

```lean
-- 列表映射
def map {α β : Type} (f : α → β) : List α → List β
  | [] => []
  | x :: xs => f x :: map f xs

-- 列表过滤
def filter {α : Type} (p : α → Bool) : List α → List α
  | [] => []
  | x :: xs => 
    if p x then x :: filter p xs
    else filter p xs

-- 列表折叠
def foldl {α β : Type} (f : β → α → β) (init : β) : List α → β
  | [] => init
  | x :: xs => foldl f (f init x) xs
```

---

## 5. 函数组合 | Function Composition

### 5.1 基本函数组合 | Basic Function Composition

```lean
-- 使用函数组合运算符
def composed_function : Nat → Nat :=
  let double := λ x => x * 2
  let add_one := λ x => x + 1
  double ∘ add_one

-- 多级组合
def multi_composition : Nat → Nat :=
  let f := λ x => x + 1
  let g := λ x => x * 2
  let h := λ x => x * x
  h ∘ g ∘ f
```

### 5.2 函数组合的数学性质 | Mathematical Properties

```lean
-- 结合律验证
theorem composition_associative (f g h : Nat → Nat) (x : Nat) :
  (f ∘ g) ∘ h x = f ∘ (g ∘ h) x := by
  simp [Function.comp]

-- 单位元
def identity_function : Nat → Nat := λ x => x

theorem composition_identity (f : Nat → Nat) (x : Nat) :
  f ∘ identity_function x = f x ∧ 
  identity_function ∘ f x = f x := by
  simp [Function.comp, identity_function]
```

### 5.3 高级函数组合 | Advanced Function Composition

```lean
-- 部分应用与组合
def partial_composition : Nat → Nat :=
  let add := λ x y => x + y
  let add_five := add 5
  let double := λ x => x * 2
  double ∘ add_five

-- 条件组合
def conditional_composition (b : Bool) : Nat → Nat :=
  let f := λ x => x + 1
  let g := λ x => x * 2
  if b then f ∘ g else g ∘ f
```

---

## 6. 代码示例 | Code Examples

### 6.1 完整示例 | Complete Example

```lean
/-- 函数式编程工具模块
   演示各种函数表达式的用法 -/
namespace FunctionalTools

-- 基本函数定义
def square : Nat → Nat := λ x => x * x
def cube : Nat → Nat := λ x => x * x * x

-- 高阶函数
def apply_twice {α : Type} (f : α → α) (x : α) : α := f (f x)

-- 函数组合
def square_then_cube : Nat → Nat := cube ∘ square
def cube_then_square : Nat → Nat := square ∘ cube

-- 列表处理高阶函数
def process_list 
  (numbers : List Nat) 
  (transformer : Nat → Nat) 
  (predicate : Nat → Bool) : List Nat :=
  numbers
    .filter predicate
    .map transformer

-- 函数工厂
def create_power_function (n : Nat) : Nat → Nat :=
  λ x => x ^ n

-- 测试函数
def test_functions : Nat → Nat :=
  let numbers := [1, 2, 3, 4, 5]
  let processed := process_list numbers square (λ x => x > 2)
  let result := processed.foldl (λ acc x => acc + x) 0
  λ _ => result

end FunctionalTools
```

### 6.2 数学函数示例 | Mathematical Function Examples

```lean
-- 数学函数库
namespace MathFunctions

-- 多项式函数
def polynomial (coefficients : List Nat) : Nat → Nat :=
  λ x => coefficients.enum.foldl 
    (λ acc (i, c) => acc + c * (x ^ i)) 0

-- 导数函数（数值近似）
def derivative (f : Nat → Nat) (x : Nat) : Nat :=
  let h := 1
  (f (x + h) - f x) / h

-- 积分函数（数值近似）
def integral (f : Nat → Nat) (a b : Nat) : Nat :=
  let step := 1
  let points := List.range (b - a + 1)
  points.foldl (λ acc i => acc + f (a + i)) 0

-- 函数极限（数值近似）
def limit (f : Nat → Nat) (x : Nat) : Nat :=
  f x

end MathFunctions
```

---

## 7. 相关性与本地跳转 | Relevance & Local Navigation

### 7.1 与Analysis目录的关联

- 与形式化方法相关：函数表达式是形式化数学的基础
- 与逻辑系统相关：高阶函数体现了逻辑的抽象层次

### 7.2 与Refactor目录的关联

- 与编程语言设计相关：函数式编程范式影响语言设计
- 与软件工程相关：函数组合提高代码复用性

### 7.3 本地跳转链接

- [返回上级目录](../01-总览.md)
- [表达式系统总览](01-总览.md)
- [基本语法元素](../02-基本语法元素/01-总览.md)
- [声明机制](../04-声明机制/01-总览.md)

---

*最后更新时间：2025年1月*
*版本：1.0*
*状态：已完成*
