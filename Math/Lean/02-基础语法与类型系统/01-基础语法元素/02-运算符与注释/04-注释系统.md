# 注释系统 | Comment System

## 1. 概述 | Overview

注释是代码中用于解释、说明和文档化的重要工具。Lean提供了多种注释方式，包括单行注释、多行注释和文档注释，帮助开发者编写清晰、可维护的代码。

Comments are important tools for explanation, clarification, and documentation in code. Lean provides various comment styles including single-line comments, multi-line comments, and documentation comments to help developers write clear and maintainable code.

## 2. 单行注释 | Single-Line Comments

### 基本单行注释 | Basic Single-Line Comments

```lean
-- 这是单行注释
-- 以双连字符开始，直到行尾

variable (x : Nat)  -- 行尾注释
def add (a b : Nat) : Nat := a + b  -- 函数定义后的注释

-- 注释可以独立成行
-- 用于解释复杂的逻辑
def complex_function (n : Nat) : Nat :=
  -- 计算阶乘
  match n with
  | 0 => 1
  | n + 1 => (n + 1) * complex_function n
```

### 注释风格 | Comment Styles

```lean
-- 简洁注释：解释代码的目的
def square (x : Nat) : Nat := x * x

-- 详细注释：解释复杂的算法
def fibonacci (n : Nat) : Nat :=
  -- 使用递归计算斐波那契数
  -- 时间复杂度：O(2^n)，空间复杂度：O(n)
  match n with
  | 0 => 0
  | 1 => 1
  | n + 2 => fibonacci n + fibonacci (n + 1)

-- TODO注释：标记待完成的任务
-- TODO: 优化算法性能，使用动态规划
def slow_fibonacci (n : Nat) : Nat :=
  match n with
  | 0 => 0
  | 1 => 1
  | n + 2 => slow_fibonacci n + slow_fibonacci (n + 1)
```

## 3. 多行注释 | Multi-Line Comments

### 基本多行注释 | Basic Multi-Line Comments

```lean
/-
这是多行注释
可以跨越多行
用于详细说明复杂的概念
-/

def example_function : Nat := 42

/-
多行注释特别适用于：
1. 解释复杂的算法
2. 提供详细的API文档
3. 说明设计决策
4. 记录重要的注意事项
-/
```

### 嵌套注释 | Nested Comments

```lean
/-
外层注释开始
  /-
  内层注释
  可以嵌套
  -/
外层注释继续
-/

def nested_comment_example : Nat := 42
```

## 4. 文档注释 | Documentation Comments

### 函数文档注释 | Function Documentation Comments

```lean
/-- 计算两个自然数的和
    @param a 第一个加数
    @param b 第二个加数
    @return 两个数的和
-/
def add (a b : Nat) : Nat := a + b

/-- 计算自然数的阶乘
    使用递归实现，对于大数可能效率较低
    @param n 要计算阶乘的自然数
    @return n的阶乘
-/
def factorial (n : Nat) : Nat :=
  match n with
  | 0 => 1
  | n + 1 => (n + 1) * factorial n
```

### 类型文档注释 | Type Documentation Comments

```lean
/-- 表示一个点的数据结构
    包含x和y坐标
-/
structure Point where
  x : Float
  y : Float
  deriving Repr

/-- 表示颜色的枚举类型
    支持基本的RGB颜色
-/
inductive Color where
  | red : Color
  | green : Color
  | blue : Color
  | yellow : Color
  | cyan : Color
  | magenta : Color
  deriving Repr
```

### 模块文档注释 | Module Documentation Comments

```lean
/-- 数学工具模块
    提供基本的数学运算函数
    包括算术、几何和统计函数
-/
namespace MathUtils

/-- 计算两点之间的距离
    @param p1 第一个点
    @param p2 第二个点
    @return 两点之间的欧几里得距离
-/
def distance (p1 p2 : Point) : Float :=
  Float.sqrt ((p1.x - p2.x)^2 + (p1.y - p2.y)^2)

end MathUtils
```

## 5. 特殊注释 | Special Comments

### 禁用代码注释 | Disable Code Comments

```lean
-- 临时禁用代码
-- def old_function (x : Nat) : Nat := x * 2

-- 使用多行注释禁用代码块
/-
def experimental_feature (x : Nat) : Nat :=
  -- 实验性功能，暂时禁用
  x * 3
-/

def current_function (x : Nat) : Nat := x + 1
```

### 调试注释 | Debug Comments

```lean
def debug_example (x : Nat) : Nat :=
  let result := x * 2
  -- DEBUG: 打印中间结果
  -- dbg_trace "x = {x}, result = {result}"
  result + 1
```

### 性能注释 | Performance Comments

```lean
-- 性能关键函数
-- 注意：此函数在热路径中被调用，需要优化
def performance_critical (xs : List Nat) : Nat :=
  xs.foldl (· + ·) 0

-- 内存使用注释
-- 警告：此函数可能分配大量内存
def memory_intensive (n : Nat) : List Nat :=
  List.range n
```

## 6. 注释最佳实践 | Comment Best Practices

### 注释内容 | Comment Content

```lean
-- 好的注释：解释为什么，而不是什么
def process_data (data : List String) : List String :=
  -- 过滤空字符串，避免后续处理错误
  data.filter (· ≠ "")

-- 避免的注释：重复代码内容
-- def add (a b : Nat) : Nat := a + b  -- 将a和b相加

-- 好的注释：解释复杂的逻辑
def binary_search (arr : List Nat) (target : Nat) : Option Nat :=
  -- 使用二分搜索在有序数组中查找目标值
  -- 时间复杂度：O(log n)
  let rec search (left right : Nat) : Option Nat :=
    if left > right then none
    else
      let mid := (left + right) / 2
      let mid_val := arr.get! mid
      if mid_val = target then some mid
      else if mid_val < target then search (mid + 1) right
      else search left (mid - 1)
  search 0 (arr.length - 1)
```

### 注释格式 | Comment Formatting

```lean
-- 使用一致的注释格式
-- 1. 注释以大写字母开始
-- 2. 使用完整的句子
-- 3. 在句末使用句号

/-- 计算最大公约数
    使用欧几里得算法
    @param a 第一个数
    @param b 第二个数
    @return a和b的最大公约数
-/
def gcd (a b : Nat) : Nat :=
  if b = 0 then a else gcd b (a % b)

-- 使用空行分隔注释和代码
-- 这样提高可读性

def example : Nat := 42
```

### 注释维护 | Comment Maintenance

```lean
-- 保持注释与代码同步
-- 当代码改变时，及时更新注释

-- 旧版本（已过时）
-- def old_add (a b : Nat) : Nat := a + b

-- 新版本
/-- 计算两个自然数的和
    支持溢出检查
    @param a 第一个加数
    @param b 第二个加数
    @return 两个数的和，如果溢出则返回0
-/
def safe_add (a b : Nat) : Nat :=
  if a + b < a then 0 else a + b
```

## 7. 文档生成 | Documentation Generation

### 自动文档生成 | Automatic Documentation Generation

```lean
/-- 用户信息结构
    包含用户的基本信息
-/
structure User where
  /-- 用户ID，唯一标识符 -/
  id : Nat
  /-- 用户名，用于显示 -/
  name : String
  /-- 用户邮箱地址 -/
  email : String
  /-- 用户年龄 -/
  age : Nat
  deriving Repr

/-- 创建新用户
    @param name 用户名
    @param email 邮箱地址
    @param age 年龄
    @return 新创建的用户对象
-/
def create_user (name : String) (email : String) (age : Nat) : User :=
  { id := 0  -- TODO: 生成唯一ID
  , name := name
  , email := email
  , age := age
  }
```

### API文档注释 | API Documentation Comments

```lean
/-- 数学运算模块
    提供基本的数学运算功能
-/
namespace MathOps

/-- 加法运算
    @param a 第一个操作数
    @param b 第二个操作数
    @return a + b的结果
-/
def add (a b : Nat) : Nat := a + b

/-- 乘法运算
    @param a 第一个操作数
    @param b 第二个操作数
    @return a * b的结果
-/
def multiply (a b : Nat) : Nat := a * b

/-- 幂运算
    @param base 底数
    @param exp 指数
    @return base^exp的结果
-/
def power (base exp : Nat) : Nat := base ^ exp

end MathOps
```

## 8. 注释工具和约定 | Comment Tools and Conventions

### 注释标记 | Comment Tags

```lean
-- FIXME: 需要修复的性能问题
def slow_function (n : Nat) : Nat :=
  match n with
  | 0 => 1
  | n + 1 => slow_function n + slow_function (n - 1)

-- NOTE: 这个函数使用了特殊的算法
def special_algorithm (x : Nat) : Nat :=
  x * 2 + 1

-- WARNING: 此函数可能抛出异常
def risky_function (x : Nat) : Nat :=
  if x = 0 then 0 else 1 / x

-- HACK: 临时解决方案，需要重构
def temporary_solution (x : Nat) : Nat :=
  -- 使用硬编码值作为临时解决方案
  42
```

### 版本控制注释 | Version Control Comments

```lean
-- 版本历史：
-- v1.0: 初始实现
-- v1.1: 添加错误处理
-- v1.2: 性能优化
def versioned_function (x : Nat) : Nat :=
  x + 1

-- 作者信息
-- 作者：张三
-- 创建日期：2025-01-01
-- 最后修改：2025-01-15
def authored_function (x : Nat) : Nat :=
  x * 2
```

## 9. 注释质量检查 | Comment Quality Checks

### 注释完整性 | Comment Completeness

```lean
-- 检查注释是否完整
-- 1. 所有公共函数都有文档注释
-- 2. 复杂逻辑都有解释注释
-- 3. 重要的设计决策都有记录

/-- 完整的函数文档
    包含所有必要信息
-/
def well_documented_function (param1 : Nat) (param2 : String) : Bool :=
  -- 实现逻辑的详细说明
  param1 > 0 && param2.length > 0

-- 检查注释的准确性
-- 确保注释描述与实际代码行为一致
def accurate_comment_example (x : Nat) : Nat :=
  -- 返回x的平方（注释与实际行为一致）
  x * x
```

### 注释可读性 | Comment Readability

```lean
-- 使用清晰的语言
-- 避免技术术语过多
-- 保持注释简洁明了

/-- 计算列表的平均值
    如果列表为空，返回0
-/
def average (xs : List Nat) : Float :=
  if xs.isEmpty then 0.0
  else (xs.sum : Float) / xs.length

-- 使用示例注释
-- 示例：average [1, 2, 3, 4] = 2.5
```

---

*相关链接：*

- [算术运算符](./01-算术运算符.md)
- [逻辑运算符](./02-逻辑运算符.md)
- [位运算符](./03-位运算符.md)
- [标识符与关键字](../01-标识符与关键字/01-总览.md)
- [字面量与常量](../03-字面量与常量/01-总览.md)
- [类型系统基础](../../02-类型系统基础.md)

## 练习 | Exercises

1. 为复杂的数学函数编写完整的文档注释
2. 使用注释标记代码中的TODO和FIXME项
3. 创建模块级别的文档注释
4. 练习编写清晰、准确的代码注释

---

*最后更新：2025年1月*
*版本：1.0*
