# 类型系统基础 | Type System Fundamentals

## 1. 类型层次结构 | Type Hierarchy

### 类型宇宙 | Type Universes

```lean
-- 类型宇宙层次
#check Type 0 : Type 1
#check Type 1 : Type 2
#check Type 2 : Type 3

-- 命题宇宙
#check Prop : Type 0

-- 排序宇宙
#check Sort 0 : Sort 1
#check Sort 1 : Sort 2
```

### 基础类型 | Basic Types

```lean
-- 自然数类型
#check Nat : Type

-- 布尔类型
#check Bool : Type

-- 字符串类型
#check String : Type

-- 单位类型
#check Unit : Type
```

## 2. 函数类型 | Function Types

### 简单函数类型 | Simple Function Types

```lean
-- 一元函数
#check Nat → Nat

-- 多元函数
#check Nat → Nat → Nat

-- 等价写法
#check Nat → (Nat → Nat)
```

### 依赖函数类型 | Dependent Function Types

```lean
-- Π类型（依赖函数）
#check (n : Nat) → Fin n

-- 等价于
#check Π (n : Nat), Fin n

-- 实际应用
def vectorGet {α : Type} (n : Nat) (v : Vector α n) (i : Fin n) : α :=
  v.get i
```

## 3. 积类型与和类型 | Product and Sum Types

### 积类型 | Product Types

```lean
-- 简单积类型
#check Nat × String

-- 构造积
def pair_example : Nat × String := (42, "hello")

-- 访问分量
#check pair_example.1  -- 第一个分量
#check pair_example.2  -- 第二个分量
```

### 和类型 | Sum Types

```lean
-- 简单和类型
#check Nat ⊕ String

-- 构造和类型
def left_example : Nat ⊕ String := Sum.inl 42
def right_example : Nat ⊕ String := Sum.inr "hello"

-- 模式匹配
def process_sum (s : Nat ⊕ String) : String :=
  match s with
  | Sum.inl n => "Number: " ++ toString n
  | Sum.inr str => "String: " ++ str
```

## 4. 归纳类型 | Inductive Types

### 基本归纳类型 | Basic Inductive Types

```lean
-- 自然数定义
-- 提示：Lean 4 已内置 `Nat`，下例仅为教学示例，避免在实际代码中重定义
inductive Nat' where
  | zero : Nat'
  | succ (n : Nat') : Nat'

-- 列表定义
inductive List' (α : Type) where
  | nil : List' α
  | cons (head : α) (tail : List' α) : List' α
```

### 参数化归纳类型 | Parametric Inductive Types

```lean
-- 向量类型
inductive Vector (α : Type) : Nat → Type where
  | nil : Vector α 0
  | cons (head : α) (tail : Vector α n) : Vector α (n + 1)

-- 使用示例
def emptyVector : Vector Nat 0 := Vector.nil
def singleVector : Vector Nat 1 := Vector.cons 42 Vector.nil
```

## 5. 类型族 | Type Families

### 索引类型族 | Indexed Type Families

```lean
-- 有限类型族
-- 提示：Lean 4 已内置 `Fin`，此处以 `Fin'` 教学
inductive Fin' : Nat → Type where
  | zero (n : Nat) : Fin' (n + 1)
  | succ (n : Nat) (i : Fin' n) : Fin' (n + 1)

-- 使用示例
#check Fin 3  -- 内置：包含0, 1, 2的类型
```

### 依赖类型族 | Dependent Type Families

```lean
-- 相等类型族
-- 提示：Lean 4 已内置 `Eq`，此处以 `Eq'` 教学
inductive Eq' {α : Type} (a : α) : α → Prop where
  | refl : Eq' a a

-- 使用示例
def proofOfEquality : Eq 2 (1 + 1) := rfl
```

## 6. 类型类 | Type Classes

### 基本类型类 | Basic Type Classes

```lean
-- 可加类型类
class Add (α : Type) where
  add : α → α → α

-- 实例定义
instance : Add Nat where
  add := Nat.add

-- 使用
-- 用法示例
example : Nat := Add.add 2 3
```

### 多参数类型类 | Multi-Parameter Type Classes

```lean
-- 关系类型类
class LE (α : Type) where
  le : α → α → Prop

-- 实例
instance : LE Nat where
  le := Nat.le

-- 使用
example : Prop := LE.le 2 3
```

## 7. 类型推导 | Type Inference

### 自动类型推导 | Automatic Type Inference

```lean
-- Lean自动推导类型
def add_two (x) := x + 2  -- x被推导为Nat
def concat_strings (s1 s2) := s1 ++ s2  -- 推导为String → String → String
```

### 类型注解 | Type Annotations

```lean
-- 显式类型注解
def explicit_add (x : Nat) (y : Nat) : Nat := x + y

-- 局部类型注解
def local_annotation : Nat := (42 : Nat)
```

## 8. 类型安全 | Type Safety

### 类型检查 | Type Checking

```lean
-- 类型错误示例（注释掉以避免编译错误）
-- def type_error : Nat := "hello"  -- 类型不匹配

-- 正确的类型使用
def correct_usage : String := "hello"
```

### 类型转换 | Type Conversion

```lean
-- 自然数到整数
def nat_to_int (n : Nat) : Int := Int.ofNat n

-- 整数到自然数（需要证明非负）
def int_to_nat (i : Int) (h : 0 ≤ i) : Nat := Int.toNat i
```

---

*相关链接：*

- [基础语法元素](./01-基础语法元素.md)
- [表达式与声明](./03-表达式与声明.md)
- [证明系统与策略](../03-证明系统与策略/01-交互式证明环境.md)
