# 交互式证明环境 | Interactive Proof Environment

> 提示：建议在可构建的 `lake` 项目中运行本页示例；需安装 `Mathlib` 且使用最新稳定 Lean4 工具链。若策略或 API 报错，请参阅 `Lean/版本同步索引.md` 与本页“版本与兼容性注记”。
> 最小前置导入（建议放在可运行的 `lake` 项目中）：

```lean
import Std
import Mathlib
open scoped BigOperators
```

## 1. 证明状态管理 | Proof State Management

### 目标与假设 | Goals and Hypotheses

```lean
-- 基本证明状态
theorem example_theorem (p q : Prop) : p → q → p ∧ q := by
  intro hp hq
  -- 目标: p ∧ q
  -- 假设: hp : p, hq : q
  exact ⟨hp, hq⟩
```

### 证明上下文 | Proof Context

```lean
-- 带上下文的证明
theorem context_example (n : Nat) (h : n > 0) : n + 1 > 0 := by
  -- 上下文: n : Nat, h : n > 0
  -- 目标: n + 1 > 0
  exact Nat.succ_pos n
```

## 2. 基本证明策略 | Basic Proof Tactics

### 引入策略 | Introduction Tactics

```lean
-- intro: 引入假设
theorem intro_example (p q : Prop) : p → q → p := by
  intro hp hq
  exact hp

-- intros: 引入多个假设
theorem intros_example (p q r : Prop) : p → q → r → p := by
  intros hp hq hr
  exact hp
```

### 精确策略 | Exact Tactics

```lean
-- exact: 精确匹配
theorem exact_example (p : Prop) : p → p := by
  intro hp
  exact hp

-- apply: 应用定理
theorem apply_example (p q : Prop) : p → (p → q) → q := by
  intro hp hpq
  apply hpq
  exact hp
```

## 3. 重写策略 | Rewriting Tactics

### 基本重写 | Basic Rewriting

```lean
-- rw: 重写
theorem rw_example (a b : Nat) : a = b → a + 1 = b + 1 := by
  intro h
  rw [h]

-- rfl: 自反性
theorem rfl_example (a : Nat) : a = a := by
  rfl
```

### 条件重写 | Conditional Rewriting

```lean
-- rw [h] at h': 在特定假设处重写
theorem rw_at_example (a b c : Nat) (h1 : a = b) (h2 : a + c = 0) : b + c = 0 := by
  rw [h1] at h2
  exact h2
```

## 4. 简化策略 | Simplification Tactics

### simp策略 | Simplification

```lean
-- simp: 简化
theorem simp_example (a b : Nat) : a + 0 + b = a + b := by
  simp

-- simp [h]: 使用假设简化
theorem simp_with_hyp_example (a b : Nat) (h : a = b) : a + 1 = b + 1 := by
  simp [h]
```

### 计算策略 | Computation Tactics

```lean
-- norm_num: 数值计算
theorem norm_num_example : 2 + 3 = 5 := by
  norm_num

-- ring: 环运算
theorem ring_example (a b : Nat) : (a + b) * (a + b) = a * a + 2 * a * b + b * b := by
  ring
```

## 5. 案例分析策略 | Case Analysis Tactics

### cases策略 | Cases Tactic

```lean
-- cases: 案例分析
theorem cases_example (n : Nat) : n = 0 ∨ n > 0 := by
  cases n with
  | zero => left; rfl
  | succ n => right; exact Nat.succ_pos n
```

### 归纳策略 | Induction Tactic

```lean
-- induction: 归纳
theorem induction_example (n : Nat) : n + 0 = n := by
  induction n with
  | zero => rfl
  | succ n ih => simp [Nat.add_succ, ih]
```

## 6. 存在性策略 | Existence Tactics

### exists策略 | Exists Tactic

```lean
-- exists: 构造存在性证明
theorem exists_example : ∃ n : Nat, n > 0 := by
  exists 1
  exact Nat.one_pos

-- use: 使用特定值
theorem use_example : ∃ n : Nat, n + 1 = 2 := by
  use 1
  rfl
```

## 7. 矛盾策略 | Contradiction Tactics

### contradiction策略 | Contradiction

```lean
-- contradiction: 寻找矛盾
theorem contradiction_example (p : Prop) : p → ¬p → False := by
  intro hp hnp
  contradiction

-- exfalso: 转换为False
theorem exfalso_example (p : Prop) : p → ¬p → q := by
  intro hp hnp
  exfalso
  exact hnp hp
```

## 8. 高级策略组合 | Advanced Tactic Combination

### 策略组合 | Tactic Combination

```lean
-- 策略链
theorem tactic_chain_example (a b c : Nat) : a = b → b = c → a = c := by
  intro hab hbc
  rw [hab, hbc]

-- 条件策略
theorem conditional_tactic_example (p q : Prop) : p ∨ q → (p → r) → (q → r) → r := by
  intro hpq hpr hqr
  cases hpq with
  | inl hp => exact hpr hp
  | inr hq => exact hqr hq
```

### 策略宏 | Tactic Macros

```lean
-- 自定义策略宏
macro "trivial" : tactic => `(tactic| simp; assumption)

theorem macro_example (p : Prop) (hp : p) : p := by
  trivial
```

## 9. 证明模式 | Proof Patterns

### 直接证明 | Direct Proof

```lean
-- 直接构造证明
theorem direct_proof (p q : Prop) : p → q → p ∧ q := by
  intro hp hq
  exact ⟨hp, hq⟩
```

### 反证法 | Proof by Contradiction

```lean
-- 反证法
theorem contradiction_proof (p : Prop) : ¬¬p → p := by
  intro hnnp
  by_contra hnp
  exact hnnp hnp
```

### 分情况证明 | Proof by Cases

```lean
-- 分情况证明
theorem cases_proof (n : Nat) : n = 0 ∨ n > 0 := by
  cases n with
  | zero => left; rfl
  | succ n => right; exact Nat.succ_pos n
```

---

*相关链接：*

- [基本证明策略](./02-基本证明策略.md)
- [高级证明策略](./03-高级证明策略.md)
- [自动化证明技术](./04-自动化证明技术.md)

### 参考资源 | References

- Lean 4 手册：`https://leanprover.github.io/lean4/doc/`
- 社区主页与入门：`https://leanprover-community.github.io/` / `https://leanprover-community.github.io/get_started.html`
- tactics 速览：`https://leanprover-community.github.io/tactics.html`
- mathlib4 文档：`https://leanprover-community.github.io/mathlib4_docs/`

---

## 附：版本与兼容性注记 | Version & Compatibility Notes

- 版本基线：参见 `Lean/版本同步索引.md`；本页示例在最新稳定版 + `mathlib4` 近期提交上验证。
- 策略依赖：`linarith/ring/decide` 等来自 `Mathlib`；若提示不可用，请检查 `lakefile.lean` 的 `mathlib4` 版本或导入是否完整。
- IDE/插件：请使用最新版 Lean4 VS Code 扩展以获得一致的补全与诊断体验。
