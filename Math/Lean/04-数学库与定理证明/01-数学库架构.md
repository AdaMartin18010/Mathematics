# 数学库架构 | Mathematical Library Architecture

> 提示：建议在可构建的 `lake` 项目中运行本页示例；需安装 `Mathlib` 且使用最新稳定 Lean4 工具链。若模块或定理名变动，请参阅 `Lean/版本同步索引.md` 与本页“版本与兼容性注记”。
> 最小前置导入（建议放在可运行的 `lake` 项目中）：

```lean
import Std
import Mathlib
open scoped BigOperators
```

## 常用模块导入清单 | Common Imports Cheat Sheet

- 线性/非线性算术：`import Mathlib/Tactic/Linarith`，`import Mathlib/Tactic/Nlinarith`
- 多项式与环化简：`import Mathlib/Tactic/Ring`，`import Mathlib/Algebra/Ring/RingNF`
- 域上代数化简：`import Mathlib/Tactic/FieldSimp`
- 拓扑与滤子：`import Mathlib/Topology/Basic`，`import Mathlib/Topology/Instances/Real`
- 测度与积分：`import Mathlib/Measure/Integral/IntervalIntegral`

> 可运行最小项目模板与说明，见：`Lean/03-证明系统与策略/04-自动化证明技术.md`（含 lake 配置与导入示例）。
> 命名提示：避免与 `Mathlib` 内置结构/定理重名（如 `Group/Ring/Field`）。教学示例可使用自定义前缀或本地命名空间隔离。

## 1. Mathlib概述 | Mathlib Overview

### 库结构 | Library Structure

```lean
-- 按需导入常用模块（示例）
import Mathlib/Data/Nat/Basic
import Mathlib/Data/List/Basic
import Mathlib/Algebra/Group/Basic
import Mathlib/Topology/Basic
import Mathlib/Analysis/Calculus/Derivative
```

## 可运行样例 | Runnable Samples

```lean
-- 基本等式化简（ℤ）
theorem arch_ring_nf (a b : ℤ) : (a + b) - a = b := by
  ring_nf

-- 线性不等式（ℚ）：可由 linarith 解决
theorem lin_ineq (a b c : ℚ) (h1 : a ≤ b) (h2 : b ≤ c) : a ≤ c := by
  linarith
```

### 模块组织 | Module Organization

```lean
-- 数据模块
import Mathlib/Data/Nat/Basic      -- 自然数基础
import Mathlib/Data/Int/Basic      -- 整数基础
import Mathlib/Data/Real/Basic     -- 实数基础

-- 代数模块
import Mathlib/Algebra/Group/Basic -- 群论基础
import Mathlib/Algebra/Ring/Basic  -- 环论基础
import Mathlib/Algebra/Field/Basic -- 域论基础

-- 分析模块
import Mathlib/Analysis/Calculus/Derivative  -- 导数与微积分基础
import Mathlib/Analysis/Complex/Basic        -- 复分析基础
-- import Mathlib/Analysis/Fourier/Basic     -- 视版本可用性而定
```

## 2. 基础数学结构 | Basic Mathematical Structures

### 自然数 | Natural Numbers

```lean
-- 自然数基本运算与性质
#check Nat.zero
#check Nat.succ
#check Nat.add
#check Nat.mul

theorem nat_add_comm (a b : Nat) : a + b = b + a := Nat.add_comm a b
theorem nat_mul_assoc (a b c : Nat) : (a * b) * c = a * (b * c) := Nat.mul_assoc a b c
```

### 整数 | Integers

```lean
-- 整数与运算
#check Int.ofNat
#check Int.neg
theorem int_add_comm (a b : Int) : a + b = b + a := Int.add_comm a b
theorem int_mul_comm (a b : Int) : a * b = b * a := Int.mul_comm a b
```

### 有理数 | Rational Numbers

```lean
-- 有理数（注意：Mathlib 中对 `Rat` 的接口以定理/实例为主）
#check Rat
-- 典型性质通常通过通用代数结构获得，这里略。
```

## 3. 代数结构 | Algebraic Structures

### 群论 | Group Theory

```lean
-- 提示：为避免与 Mathlib 中的结构/名称冲突，以下教学示例使用自定义前缀
class MyGroup (G : Type) extends Mul G, One G, Inv G where
  mul_assoc : ∀ a b c : G, (a * b) * c = a * (b * c)
  one_mul : ∀ a : G, 1 * a = a
  mul_one : ∀ a : G, a * 1 = a
  mul_left_inv : ∀ a : G, a⁻¹ * a = 1

theorem group_mul_right_inv (G : Type) [MyGroup G] (a : G) : a * a⁻¹ = 1 := by
  have h := MyGroup.mul_left_inv a
  exact h
```

### 环论 | Ring Theory

```lean
class MyRing (R : Type) extends Add R, Mul R, Neg R, Zero R, One R where
  add_assoc : ∀ a b c : R, (a + b) + c = a + (b + c)
  add_comm : ∀ a b : R, a + b = b + a
  add_zero : ∀ a : R, a + 0 = a
  add_left_neg : ∀ a : R, -a + a = 0
  mul_assoc : ∀ a b c : R, (a * b) * c = a * (b * c)
  mul_one : ∀ a : R, a * 1 = a
  one_mul : ∀ a : R, 1 * a = a
  left_distrib : ∀ a b c : R, a * (b + c) = a * b + a * c
  right_distrib : ∀ a b c : R, (a + b) * c = a * c + b * c
```

### 域论 | Field Theory

```lean
class MyField (F : Type) extends MyRing F, Inv F where
  mul_comm : ∀ a b : F, a * b = b * a
  mul_inv_cancel : ∀ a : F, a ≠ 0 → a * a⁻¹ = 1
  inv_zero : (0 : F)⁻¹ = 0

theorem field_mul_right_inv (F : Type) [MyField F] (a : F) (ha : a ≠ 0) : a * a⁻¹ = 1 :=
  MyField.mul_inv_cancel a ha
```

## 4. 线性代数 | Linear Algebra

### 向量空间 | Vector Spaces

```lean
-- Mathlib 使用 `Module K V` 表示 K 上的向量空间；此处教学用自定义名
class MyVectorSpace (V : Type) (K : Type) [MyField K] extends Add V, SMul K V where
  smul_assoc : ∀ (a b : K) (v : V), (a * b) • v = a • (b • v)
  one_smul : ∀ v : V, (1 : K) • v = v

structure MyLinearMap (V W : Type) where
  toFun : V → W
```

### 矩阵理论 | Matrix Theory

```lean
-- 教学矩阵（Mathlib 有丰富矩阵库，可优先使用 Mathlib 实现）
def Matrix' (m n : Nat) (α : Type) := Fin m → Fin n → α

def Matrix'.add {m n : Nat} {α : Type} [Add α] (A B : Matrix' m n α) : Matrix' m n α :=
  fun i j => A i j + B i j

def Matrix'.mul {m n p : Nat} {α : Type} [Add α] [Mul α] (A : Matrix' m n α) (B : Matrix' n p α) : Matrix' m p α :=
  fun i k => ∑ j, A i j * B j k
```

## 5. 拓扑学 | Topology

### 拓扑空间 | Topological Spaces

```lean
-- Mathlib 已内置 `TopologicalSpace`；此处教学用自定义名避免冲突
class TopologicalSpace' (X : Type) where
  IsOpen : Set X → Prop

def Continuous' {X Y : Type} [TopologicalSpace' X] [TopologicalSpace' Y] (f : X → Y) : Prop :=
  True
```

### 度量空间 | Metric Spaces

```lean
class MetricSpace' (X : Type) where
  dist : X → X → ℝ

-- 示例性质省略
```

## 6. 分析学 | Analysis

### 极限理论 | Limit Theory

```lean
-- 教学占位定义（Mathlib 已提供完整分析学框架）
def Tendsto' : Prop := True
def SeqLimit' : Prop := True
```

### 微积分 | Calculus

```lean
-- 请参考 Mathlib：`HasDerivAt`、`Integrable` 等已有定义与定理
-- 此处不重复自定义定义，以免冲突
```

## 7. 数论 | Number Theory

### 整除理论 | Divisibility Theory

```lean
-- 建议直接使用 Mathlib 的整除与 gcd 框架；教学示例使用自定义名
def Dvd' (a b : ℤ) : Prop := ∃ c : ℤ, b = a * c

def gcd' (a b : ℤ) : ℤ := a.gcd b
```

### 素数理论 | Prime Theory

```lean
-- 直接使用 Mathlib 的素数与相关定理（`Nat.Prime` 等）
```

## 8. 库使用最佳实践 | Library Usage Best Practices

### 导入策略 | Import Strategy

```lean
-- 按需导入（推荐）
import Std
import Mathlib
-- 精细模块在需要时再补充

-- 避免过度导入
-- import Mathlib/All  -- 不推荐
```

## 9. 练习与参考解 | Exercises with Hints

```lean
-- 练习1：证明 Nat 加法交换律（提示：Nat.add_comm）
theorem ex1 (a b : Nat) : a + b = b + a := by
  exact Nat.add_comm a b

-- 练习2：证明 Int 加法交换律（提示：Int.add_comm）
theorem ex2 (a b : Int) : a + b = b + a := by
  exact Int.add_comm a b

-- 练习3：证明 (a + b) + c = a + (b + c)（实数，提示：add_assoc）
theorem ex3 (a b c : ℝ) : (a + b) + c = a + (b + c) := by
  simpa using add_assoc a b c
```

### 命名约定 | Naming Conventions

```lean
-- 使用标准命名
theorem nat_add_comm (a b : Nat) : a + b = b + a := Nat.add_comm a b

-- 避免重复定义/命名冲突
-- theorem add_comm (a b : Nat) : a + b = b + a := Nat.add_comm a b  -- 不推荐
```

---

*相关链接：*

- [基础数学概念](./02-基础数学概念.md)
- [代数结构](./03-代数结构.md)
- [分析学与拓扑](./04-分析学与拓扑.md)
- 练习总览：`Lean/Exercises/README.md`
- 跨章节练习索引：`Lean/Exercises/跨章节练习索引.md`
- 练习参考解索引：`Lean/Exercises/练习参考解索引.md`

---

## 附：版本与兼容性注记 | Version & Compatibility Notes

- 版本基线：参见 `Lean/版本同步索引.md`；本页导入路径与示例基于最新稳定版 + 近期 `mathlib4` 提交。
- 模块路径：Mathlib4 可能调整模块层级与命名；若导入失败，请在 `mathlib4_docs` 搜索最新路径并更新。
- 运行建议：避免一次性全量导入，按需细化模块以减少编译时间与冲突。
