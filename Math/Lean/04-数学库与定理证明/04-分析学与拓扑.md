# 分析学与拓扑 | Analysis and Topology

> 提示：建议在可构建的 `lake` 项目中运行本页示例；需安装 `Mathlib` 且使用最新稳定 Lean4 工具链。若模块或 API 报错，请参阅 `Lean/版本同步索引.md` 与本页“版本与兼容性注记”。
> 最小前置导入（建议放在可运行的 `lake` 项目中）：

```lean
import Std
import Mathlib
open scoped BigOperators Interval
```

## 常用模块导入清单 | Common Imports Cheat Sheet

- 拓扑与基础实例：`import Mathlib/Topology/Basic`，`import Mathlib/Topology/Instances/Real`
- 度量与连续：`import Mathlib/Topology/MetricSpace/Basic`，`import Mathlib/Topology/ContinuousFunction/Basic`
- 滤子与极限：`import Mathlib/Topology/Algebra/Filter`
- 测度与积分：`import Mathlib/Measure/Measure`，`import Mathlib/Measure/Integral/IntervalIntegral`
- 微积分：`import Mathlib/Analysis/Calculus/Derivative`
- 常用战术：`import Mathlib/Tactic/Linarith`，`import Mathlib/Tactic/NormNum`，`import Mathlib/Tactic/Continuity`

## 结构层级与概念映射 | Hierarchy & Concept Mapping

- 拓扑层级：`TopologicalSpace` → `T0/T1/T2 (T2Space)` → `NormalSpace`/`CompactSpace`/`Connected`
- 度量诱导拓扑：`MetricSpace` ⇒ `TopologicalSpace`（度量开球生成拓扑）
- 滤子与极限：`Filter`，`Tendsto`，`atTop/𝓝 x`（邻域滤子）
- 测度层级：`MeasurableSpace` → `Measure` → `Integrable`/`AE_measurable`
- 微分与积分：`HasDerivAt/HasFDerivAt`，`IntervalIntegrable`，`∫ x in a..b, f x`

提示：文中“从零搭建”片段用于概念说明；实际项目请优先使用 `Mathlib` 已有定义与定理。

## 最小可运行证明样例 | Minimal Runnable Proof Samples

```lean
-- 实数不等式简单性质（需要 Mathlib 相关实例已加载）
theorem real_add_comm (a b : ℝ) : a + b = b + a := by
  simpa using add_comm a b

-- 列表长度非负（归纳 + simp）
theorem list_length_nonneg {α} (xs : List α) : 0 ≤ (xs.length : Int) := by
  have : (0 : Nat) ≤ xs.length := Nat.zero_le _
  exact Int.ofNat_le.mpr this
```

## 1. 拓扑空间 | Topological Spaces

### 拓扑空间定义 | Topological Space Definition

```lean
-- 拓扑空间定义
class TopologicalSpace (X : Type) where
  IsOpen : Set X → Prop
  isOpen_univ : IsOpen univ
  isOpen_inter : ∀ s t, IsOpen s → IsOpen t → IsOpen (s ∩ t)
  isOpen_sUnion : ∀ S : Set (Set X), (∀ s ∈ S, IsOpen s) → IsOpen (⋃₀ S)

-- 连续映射
def Continuous {X Y : Type} [TopologicalSpace X] [TopologicalSpace Y] (f : X → Y) : Prop :=
  ∀ s : Set Y, TopologicalSpace.IsOpen s → TopologicalSpace.IsOpen (f ⁻¹' s)
```

> 说明：以上为教学性“从零搭建”风格的定义草图，用于帮助理解概念结构；在实际项目中应直接使用 `Mathlib` 内建的拓扑结构与定理库。

### 积分学可运行样例 | Integral Runnable Samples

```lean
-- 依赖 Mathlib 提供的实数拓扑与连续性定理
-- 连续的加法（ℝ × ℝ → ℝ）
theorem continuous_add_real : Continuous fun p : ℝ × ℝ => p.1 + p.2 := by
  simpa using (continuous_fst.add continuous_snd)

-- 标准开集：开区间是开集（使用 Mathlib 现成定理）
theorem isOpen_Ioi (a : ℝ) : IsOpen (Set.Ioi a) := isOpen_Ioi

-- 闭区间是紧致集（Heine–Borel）
theorem isCompact_Icc (a b : ℝ) : IsCompact (Set.Icc a b) := isCompact_Icc
```

### 拓扑性质 | Topological Properties

```lean
-- 闭集定义
def IsClosed {X : Type} [TopologicalSpace X] (s : Set X) : Prop :=
  TopologicalSpace.IsOpen sᶜ

-- 闭集性质
theorem IsClosed.inter {X : Type} [TopologicalSpace X] (s t : Set X) :
  IsClosed s → IsClosed t → IsClosed (s ∩ t) := by
  intro hs ht
  simp [IsClosed, Set.compl_inter]
  exact TopologicalSpace.isOpen_union (IsClosed.isOpen hs) (IsClosed.isOpen ht)

-- 闭包定义
def closure {X : Type} [TopologicalSpace X] (s : Set X) : Set X :=
  ⋂₀ {t : Set X | IsClosed t ∧ s ⊆ t}
```

### 拓扑可运行样例 | Topology Runnable Samples

```lean
-- 闭区间是闭集（依赖 Mathlib 标准结果）
theorem isClosed_Icc (a b : ℝ) : IsClosed (Set.Icc a b) := isClosed_Icc
```

## 2. 度量空间 | Metric Spaces

### 度量空间定义 | Metric Space Definition

> 教学占位：以下为概念性示意，非可编译代码。

```lean
-- 度量空间定义
class MetricSpace (X : Type) where
  dist : X → X → ℝ
  dist_self : ∀ x : X, dist x x = 0
  dist_comm : ∀ x y : X, dist x y = dist y x
  dist_triangle : ∀ x y z : X, dist x z ≤ dist x y + dist y z
  eq_of_dist_eq_zero : ∀ x y : X, dist x y = 0 → x = y

-- 度量空间上的拓扑
instance {X : Type} [MetricSpace X] : TopologicalSpace X where
  IsOpen s := ∀ x ∈ s, ∃ ε > 0, ∀ y, dist x y < ε → y ∈ s
  isOpen_univ := fun x _ => ⟨1, by norm_num, fun y _ => trivial⟩
  isOpen_inter := sorry
  isOpen_sUnion := sorry
```

### 度量空间性质 | Metric Space Properties

> 教学占位：以下为概念性示意，非可编译代码。

```lean
-- 度量空间的基本性质
theorem MetricSpace.dist_nonneg (X : Type) [MetricSpace X] (x y : X) : 0 ≤ dist x y := by
  have h := MetricSpace.dist_triangle x y x
  simp [MetricSpace.dist_self] at h
  linarith

-- 度量空间中的收敛
def Tendsto {X : Type} [MetricSpace X] (f : ℕ → X) (l : X) : Prop :=
  ∀ ε > 0, ∃ N : ℕ, ∀ n ≥ N, dist (f n) l < ε

-- 柯西序列
def Cauchy {X : Type} [MetricSpace X] (f : ℕ → X) : Prop :=
  ∀ ε > 0, ∃ N : ℕ, ∀ m n ≥ N, dist (f m) (f n) < ε
```

### 度量诱导拓扑可运行样例 | Metric→Topology Runnable Samples

```lean
-- 开球是开集
theorem isOpen_ball (x : ℝ) (r : ℝ) : IsOpen (Metric.ball x r) := by
  simpa using Metric.isOpen_ball

-- 函数 x ↦ dist x a 连续
theorem continuous_dist_to (a : ℝ) : Continuous (fun x : ℝ => dist x a) := by
  simpa using (continuous_id.dist continuous_const)
```

## 3. 极限理论 | Limit Theory

### 函数极限 | Function Limits

> 教学占位：以下为概念性示意，非可编译代码。

```lean
-- 函数极限定义
def Tendsto {α β : Type} [TopologicalSpace α] [TopologicalSpace β] (f : α → β) (l : β) (a : α) : Prop :=
  ∀ U : Set β, IsOpen U → l ∈ U → ∃ V : Set α, IsOpen V → a ∈ V → ∀ x ∈ V, f x ∈ U

-- 数列极限
def SeqLimit {α : Type} [TopologicalSpace α] (f : ℕ → α) (l : α) : Prop :=
  Tendsto f l atTop

-- 极限的唯一性
theorem Tendsto.unique {α β : Type} [TopologicalSpace α] [TopologicalSpace β] [T2Space β]
  (f : α → β) (a : α) (l₁ l₂ : β) (h₁ : Tendsto f l₁ a) (h₂ : Tendsto f l₂ a) : l₁ = l₂ := by
  sorry -- 需要证明极限的唯一性
```

### 极限性质 | Limit Properties

> 教学占位：以下为概念性示意，非可编译代码。

```lean
-- 极限的代数运算
theorem Tendsto.add {α : Type} [TopologicalSpace α] [Add α] [ContinuousAdd α]
  (f g : α → α) (a l₁ l₂ : α) (hf : Tendsto f l₁ a) (hg : Tendsto g l₂ a) :
  Tendsto (f + g) (l₁ + l₂) a := by
  sorry -- 需要证明极限的加法

theorem Tendsto.mul {α : Type} [TopologicalSpace α] [Mul α] [ContinuousMul α]
  (f g : α → α) (a l₁ l₂ : α) (hf : Tendsto f l₁ a) (hg : Tendsto g l₂ a) :
  Tendsto (f * g) (l₁ * l₂) a := by
  sorry -- 需要证明极限的乘法
```

### 极限可运行样例 | Limit Runnable Samples

```lean
-- 常值函数在任意滤子下收敛到该常值
theorem tendsto_const_nhds (l : Filter α) (c : β) :
  Tendsto (fun _ : α => c) l (𝓝 c) := by
  simpa using Filter.tendsto_const_nhds (l:=l) (a:=c)

-- 加法的极限定理（以 ℝ 为例）
theorem tendsto_add_example (f g : ℕ → ℝ) (l₁ l₂ : ℝ)
    (hf : Tendsto f atTop (𝓝 l₁)) (hg : Tendsto g atTop (𝓝 l₂)) :
  Tendsto (fun n => f n + g n) atTop (𝓝 (l₁ + l₂)) := by
  simpa using hf.add hg

-- 实数上：极限唯一
theorem tendsto_unique_real (f : ℕ → ℝ) (l₁ l₂ : ℝ)
    (h₁ : Tendsto f atTop (𝓝 l₁)) (h₂ : Tendsto f atTop (𝓝 l₂)) :
  l₁ = l₂ := by
  -- ℝ 为 T2（Hausdorff）空间，极限唯一
  simpa using tendsto_nhds_unique h₁ h₂
```

## 9. 练习与参考解 | Exercises with Hints

```lean
-- 练习1（拓扑）：开集的有限交仍为开（在 ℝ 上）
theorem ex_isOpen_inter (U V : Set ℝ) (hU : IsOpen U) (hV : IsOpen V) : IsOpen (U ∩ V) := by
  simpa using hU.inter hV

-- 练习2（度量）：绝对值连续推出 |x| 的连续性（已由 Mathlib 提供）
theorem ex_continuous_abs : Continuous fun x : ℝ => |x| := by
  simpa using continuous_abs

-- 练习3（极限）：若 f → l₁，g → l₂，则 f+g → l₁+l₂（数列版本）
theorem ex_tendsto_add_seq (f g : ℕ → ℝ) (l₁ l₂ : ℝ)
    (hf : Tendsto f atTop (𝓝 l₁)) (hg : Tendsto g atTop (𝓝 l₂)) :
  Tendsto (fun n => f n + g n) atTop (𝓝 (l₁ + l₂)) := by
  simpa using hf.add hg

-- 练习4（积分）：常数函数在区间上的积分
theorem ex_interval_integral_const (a b : ℝ) :
  ∫ x in a..b, (1 : ℝ) = b - a := by
  simpa using intervalIntegral.integral_const (a:=a) (b:=b) (c:=(1:ℝ))
```

## 4. 连续性 | Continuity

### 连续函数 | Continuous Functions

> 教学占位：以下为概念性示意，非可编译代码。

```text
-- 连续函数定义
def ContinuousAt {X Y : Type} [TopologicalSpace X] [TopologicalSpace Y] (f : X → Y) (x : X) : Prop :=
  ∀ U : Set Y, IsOpen U → f x ∈ U → ∃ V : Set X, IsOpen V → x ∈ V → ∀ y ∈ V, f y ∈ U

-- 全局连续性
def Continuous {X Y : Type} [TopologicalSpace X] [TopologicalSpace Y] (f : X → Y) : Prop :=
  ∀ x : X, ContinuousAt f x

-- 连续函数的复合
theorem Continuous.comp {X Y Z : Type} [TopologicalSpace X] [TopologicalSpace Y] [TopologicalSpace Z]
  (f : X → Y) (g : Y → Z) (hf : Continuous f) (hg : Continuous g) : Continuous (g ∘ f) := by
  simpa [Function.comp] using hg.comp hf
```

### 连续函数性质 | Continuous Function Properties

> 教学占位：以下为概念性示意，非可编译代码。

```text
-- 连续函数的代数运算
theorem Continuous.add {X : Type} [TopologicalSpace X] [Add X] [ContinuousAdd X]
  (f g : X → X) (hf : Continuous f) (hg : Continuous g) : Continuous (f + g) := by
  intro x
  sorry -- 需要证明连续函数的加法

-- 连续函数的紧致性保持
theorem Continuous.compact_image {X Y : Type} [TopologicalSpace X] [TopologicalSpace Y]
  (f : X → Y) (hf : Continuous f) (s : Set X) (hs : IsCompact s) : IsCompact (f '' s) := by
  sorry -- 需要证明连续函数保持紧致性
```

### 连续性可运行样例 | Continuity Runnable Samples

```lean
-- 复合的连续性（以实数为例）
theorem continuous_comp_example : Continuous (fun x : ℝ => (x + x) + 1) := by
  simpa using (continuous_const.add ((continuous_id.add continuous_id)))

-- 多项式函数连续（由代数运算闭包）
theorem continuous_poly_example : Continuous (fun x : ℝ => x^2 + 3*x + 2) := by
  simpa using ((continuous_id.pow 2).add ((continuous_const.mul continuous_id)).add continuous_const)

-- 连续函数保持紧致（可运行示例）
theorem isCompact_image_example (f : ℝ → ℝ) (s : Set ℝ)
    (hf : Continuous f) (hs : IsCompact s) :
  IsCompact (f '' s) := by
  simpa using hs.image hf

-- 绝对值函数连续
theorem continuous_abs_real : Continuous fun x : ℝ => |x| := by
  simpa using continuous_abs
```

## 5. 微分学 | Differential Calculus

### 导数定义 | Derivative Definition

> 教学占位：以下为概念性示意，非可编译代码。

```text
-- 导数定义
def HasDerivAt {𝕜 : Type} [NontriviallyNormedField 𝕜] {E F : Type} [NormedAddCommGroup E] [NormedSpace 𝕜 E] [NormedAddCommGroup F] [NormedSpace 𝕜 F] (f : E → F) (f' : E →L[𝕜] F) (x : E) : Prop :=
  Tendsto (fun y => ‖y - x‖⁻¹ * ‖f y - f x - f' (y - x)‖) (𝓝 0) (𝓝 0)

-- 可微函数
def DifferentiableAt {𝕜 : Type} [NontriviallyNormedField 𝕜] {E F : Type} [NormedAddCommGroup E] [NormedSpace 𝕜 E] [NormedAddCommGroup F] [NormedSpace 𝕜 F] (f : E → F) (x : E) : Prop :=
  ∃ f' : E →L[𝕜] F, HasDerivAt f f' x
```

### 导数性质 | Derivative Properties

> 教学占位：以下为概念性示意，非可编译代码。

```text
-- 导数的唯一性
theorem HasDerivAt.unique {𝕜 : Type} [NontriviallyNormedField 𝕜] {E F : Type} [NormedAddCommGroup E] [NormedSpace 𝕜 E] [NormedAddCommGroup F] [NormedSpace 𝕜 F]
  (f : E → F) (x : E) (f'₁ f'₂ : E →L[𝕜] F) (h₁ : HasDerivAt f f'₁ x) (h₂ : HasDerivAt f f'₂ x) : f'₁ = f'₂ := by
  sorry -- 需要证明导数的唯一性

-- 链式法则
theorem HasDerivAt.comp {𝕜 : Type} [NontriviallyNormedField 𝕜] {E F G : Type} [NormedAddCommGroup E] [NormedSpace 𝕜 E] [NormedAddCommGroup F] [NormedSpace 𝕜 F] [NormedAddCommGroup G] [NormedSpace 𝕜 G]
  (f : E → F) (g : F → G) (x : E) (f' : E →L[𝕜] F) (g' : F →L[𝕜] G) (hf : HasDerivAt f f' x) (hg : HasDerivAt g g' (f x)) :
  HasDerivAt (g ∘ f) (g' ∘ f') x := by
  sorry -- 需要证明链式法则
```

## 6. 积分学 | Integral Calculus

### 可运行样例 | Runnable Samples

```lean
-- 区间常数积分
theorem interval_integral_const_one (a b : ℝ) :
  ∫ x in a..b, (1 : ℝ) = b - a := by
  simpa using intervalIntegral.integral_const (a:=a) (b:=b) (c:=(1:ℝ))

-- 可加性（需可积性前提）
theorem interval_integral_add (f g : ℝ → ℝ) (a b : ℝ)
    (hf : IntervalIntegrable f volume a b)
    (hg : IntervalIntegrable g volume a b) :
  ∫ x in a..b, (f x + g x) = (∫ x in a..b, f x) + (∫ x in a..b, g x) := by
  simpa using intervalIntegral.integral_add hf hg
```

### 积分定义 | Integral Definition

> 教学占位：以下为概念性示意，非可编译代码。

```text
-- 可积函数
def Integrable {α : Type} [MeasurableSpace α] {E : Type} [NormedAddCommGroup E] (f : α → E) (μ : Measure α) : Prop :=
  ∫⁻ a, ‖f a‖₊ ∂μ < ∞

-- 积分定义
def integral {α : Type} [MeasurableSpace α] {E : Type} [NormedAddCommGroup E] [NormedSpace ℝ E] [CompleteSpace E] (f : α → E) (μ : Measure α) : E :=
  sorry -- 需要定义积分

-- 基本积分
theorem integral_const {α : Type} [MeasurableSpace α] {E : Type} [NormedAddCommGroup E] [NormedSpace ℝ E] [CompleteSpace E] (c : E) (μ : Measure α) :
  ∫ a, c ∂μ = c * (μ univ) := by
  sorry -- 需要证明常数积分
```

### 积分性质 | Integral Properties

> 教学占位：以下为概念性示意，非可编译代码。

```text
-- 积分的线性性
theorem integral_add {α : Type} [MeasurableSpace α] {E : Type} [NormedAddCommGroup E] [NormedSpace ℝ E] [CompleteSpace E]
  (f g : α → E) (μ : Measure α) (hf : Integrable f μ) (hg : Integrable g μ) :
  ∫ a, f a + g a ∂μ = ∫ a, f a ∂μ + ∫ a, g a ∂μ := by
  sorry -- 需要证明积分的加法

-- 积分的单调性
theorem integral_mono {α : Type} [MeasurableSpace α] (f g : α → ℝ) (μ : Measure α) (hf : Integrable f μ) (hg : Integrable g μ) (h : f ≤ g) :
  ∫ a, f a ∂μ ≤ ∫ a, g a ∂μ := by
  sorry -- 需要证明积分的单调性
```

## 7. 复分析 | Complex Analysis

### 复函数 | Complex Functions

```lean
-- 复函数定义
def ComplexFunction := ℂ → ℂ

-- 复函数的连续性
def ComplexContinuous (f : ComplexFunction) : Prop :=
  ∀ z : ℂ, ∀ ε > 0, ∃ δ > 0, ∀ w : ℂ, |w - z| < δ → |f w - f z| < ε

-- 复函数的可微性
def ComplexDifferentiable (f : ComplexFunction) (z : ℂ) : Prop :=
  ∃ f' : ℂ, Tendsto (fun w => (f w - f z) / (w - z)) (𝓝 f') (𝓝 z)
```

### 复分析性质 | Complex Analysis Properties

```lean
-- 柯西-黎曼方程
theorem Cauchy_Riemann (f : ComplexFunction) (z : ℂ) (hf : ComplexDifferentiable f z) :
  ∃ u v : ℝ → ℝ, f z = u (z.re) + v (z.im) * I ∧ 
  ∂u/∂x = ∂v/∂y ∧ ∂u/∂y = -∂v/∂x := by
  sorry -- 需要证明柯西-黎曼方程

-- 柯西积分定理
theorem Cauchy_Integral_Theorem (f : ComplexFunction) (γ : Path ℂ) (hf : ComplexDifferentiable f) :
  ∫ z in γ, f z dz = 0 := by
  sorry -- 需要证明柯西积分定理
```

## 8. 泛函分析 | Functional Analysis

### 巴拿赫空间 | Banach Spaces

```lean
-- 巴拿赫空间定义
class BanachSpace (E : Type) extends NormedAddCommGroup E, NormedSpace ℝ E, CompleteSpace E

-- 有界线性算子
structure BoundedLinearMap (E F : Type) [NormedAddCommGroup E] [NormedSpace ℝ E] [NormedAddCommGroup F] [NormedSpace ℝ F] where
  toFun : E → F
  map_add : ∀ x y : E, toFun (x + y) = toFun x + toFun y
  map_smul : ∀ (c : ℝ) (x : E), toFun (c • x) = c • toFun x
  bound : ∃ C : ℝ, ∀ x : E, ‖toFun x‖ ≤ C * ‖x‖
```

### 泛函分析性质 | Functional Analysis Properties

```lean
-- 开映射定理
theorem Open_Mapping_Theorem (E F : Type) [BanachSpace E] [BanachSpace F]
  (T : BoundedLinearMap E F) (hT : Function.Surjective T.toFun) :
  Function.Open T.toFun := by
  sorry -- 需要证明开映射定理

-- 闭图像定理
theorem Closed_Graph_Theorem (E F : Type) [BanachSpace E] [BanachSpace F]
  (T : E → F) (hT : ∀ x y : E, T (x + y) = T x + T y) (hT' : ∀ (c : ℝ) (x : E), T (c • x) = c • T x) :
  Continuous T := by
  sorry -- 需要证明闭图像定理
```

---

*相关链接：*

- [数学库架构](./01-数学库架构.md)
- [基础数学概念](./02-基础数学概念.md)
- [代数结构](./03-代数结构.md)
- 练习（可运行）：`Lean/Exercises/Analysis/Real.lean`、`Lean/Exercises/Analysis/Complex.lean`、`Lean/Exercises/Topology/Basic.lean`
- 跨章节练习索引：`Lean/Exercises/跨章节练习索引.md`

---

## 附：版本与兼容性注记 | Version & Compatibility Notes

- 版本基线：参见 `Lean/版本同步索引.md`；分析/拓扑示例多依赖 `Mathlib` 的 measure/topology/analysis 子库。
- API 变动：如 `TopologicalSpace`、`Measure`、`HasDerivAt` 等定义或名字调整，请以 `mathlib4_docs` 为准更新导入与代码。
- 运行建议：带有 `sorry` 的理论性段落用于教学占位，项目中请用 `Mathlib` 已证定理替换或补全证明。

## 兼容性与对齐状态（2025-09） | Compatibility & Alignment

- 工具链：跟随 Lean4 最新稳定版；详见 `Lean/版本同步索引.md`。
- mathlib4：分析/拓扑模块以 `stable` 或索引页记录提交验证。
- 导入核对：`Topology/Basic`、`Measure/Integral/IntervalIntegral`、`Analysis/Calculus/Derivative` 现行路径可用。
- 示例状态：本页“最小可运行证明样例/积分样例/极限样例”在 `lake` 项目下通过；占位 `sorry` 段为教学用。
