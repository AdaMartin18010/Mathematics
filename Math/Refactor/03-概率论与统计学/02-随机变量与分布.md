# 02-随机变量与分布

## 目录

1. [随机变量概述](#1-随机变量概述)
2. [离散分布](#2-离散分布)
3. [连续分布](#3-连续分布)
4. [多元分布](#4-多元分布)
5. [分布变换](#5-分布变换)
6. [极限定理](#6-极限定理)
7. [形式化实现](#7-形式化实现)
8. [习题与练习](#8-习题与练习)
9. [参考文献](#9-参考文献)

## 1. 随机变量概述

### 1.1 随机变量的分类

**离散随机变量**：取有限或可列个值的随机变量。

**连续随机变量**：分布函数连续的随机变量。

**混合随机变量**：既有离散部分又有连续部分的随机变量。

### 1.2 分布函数

**定义 1.2.1**（分布函数）
随机变量 $X$ 的分布函数定义为：
$$F_X(x) = P(X \leq x)$$

**性质**：

1. 非减函数
2. 右连续
3. $\lim_{x \to -\infty} F_X(x) = 0$
4. $\lim_{x \to \infty} F_X(x) = 1$

## 2. 离散分布

### 2.1 伯努利分布

**定义 2.1.1**（伯努利分布）
随机变量 $X$ 服从参数为 $p$ 的伯努利分布，如果：
$$P(X = 1) = p, \quad P(X = 0) = 1-p$$

**期望和方差**：
$$E[X] = p, \quad \text{Var}(X) = p(1-p)$$

### 2.2 二项分布

**定义 2.2.1**（二项分布）
随机变量 $X$ 服从参数为 $n, p$ 的二项分布，如果：
$$P(X = k) = \binom{n}{k} p^k (1-p)^{n-k}, \quad k = 0,1,\ldots,n$$

**期望和方差**：
$$E[X] = np, \quad \text{Var}(X) = np(1-p)$$

### 2.3 泊松分布

**定义 2.3.1**（泊松分布）
随机变量 $X$ 服从参数为 $\lambda$ 的泊松分布，如果：
$$P(X = k) = \frac{\lambda^k e^{-\lambda}}{k!}, \quad k = 0,1,2,\ldots$$

**期望和方差**：
$$E[X] = \lambda, \quad \text{Var}(X) = \lambda$$

### 2.4 几何分布

**定义 2.4.1**（几何分布）
随机变量 $X$ 服从参数为 $p$ 的几何分布，如果：
$$P(X = k) = p(1-p)^{k-1}, \quad k = 1,2,3,\ldots$$

**期望和方差**：
$$E[X] = \frac{1}{p}, \quad \text{Var}(X) = \frac{1-p}{p^2}$$

## 3. 连续分布

### 3.1 均匀分布

**定义 3.1.1**（均匀分布）
随机变量 $X$ 服从区间 $[a,b]$ 上的均匀分布，如果：
$$
f_X(x) = \begin{cases}
\frac{1}{b-a} & \text{如果 } a \leq x \leq b \\
0 & \text{其他}
\end{cases}
$$

**期望和方差**：
$$E[X] = \frac{a+b}{2}, \quad \text{Var}(X) = \frac{(b-a)^2}{12}$$

### 3.2 正态分布

**定义 3.2.1**（正态分布）
随机变量 $X$ 服从参数为 $\mu, \sigma^2$ 的正态分布，如果：
$$f_X(x) = \frac{1}{\sqrt{2\pi\sigma^2}} e^{-\frac{(x-\mu)^2}{2\sigma^2}}$$

**期望和方差**：
$$E[X] = \mu, \quad \text{Var}(X) = \sigma^2$$

**性质**：

1. 线性变换：如果 $X \sim N(\mu, \sigma^2)$，则 $aX + b \sim N(a\mu + b, a^2\sigma^2)$
2. 标准化：如果 $X \sim N(\mu, \sigma^2)$，则 $Z = \frac{X-\mu}{\sigma} \sim N(0,1)$

### 3.3 指数分布

**定义 3.3.1**（指数分布）
随机变量 $X$ 服从参数为 $\lambda$ 的指数分布，如果：
$$
f_X(x) = \begin{cases}
\lambda e^{-\lambda x} & \text{如果 } x \geq 0 \\
0 & \text{其他}
\end{cases}
$$

**期望和方差**：
$$E[X] = \frac{1}{\lambda}, \quad \text{Var}(X) = \frac{1}{\lambda^2}$$

**无记忆性**：
$$P(X > s + t | X > s) = P(X > t)$$

### 3.4 伽马分布

**定义 3.4.1**（伽马分布）
随机变量 $X$ 服从参数为 $\alpha, \beta$ 的伽马分布，如果：
$$
f_X(x) = \begin{cases}
\frac{\beta^\alpha}{\Gamma(\alpha)} x^{\alpha-1} e^{-\beta x} & \text{如果 } x > 0 \\
0 & \text{其他}
\end{cases}
$$

**期望和方差**：
$$E[X] = \frac{\alpha}{\beta}, \quad \text{Var}(X) = \frac{\alpha}{\beta^2}$$

## 4. 多元分布

### 4.1 联合分布

**定义 4.1.1**（联合分布函数）
随机变量 $X, Y$ 的联合分布函数定义为：
$$F_{X,Y}(x,y) = P(X \leq x, Y \leq y)$$

**定义 4.1.2**（联合密度函数）
连续随机变量 $X, Y$ 的联合密度函数 $f_{X,Y}(x,y)$ 满足：
$$P((X,Y) \in A) = \iint_A f_{X,Y}(x,y) \, dx \, dy$$

### 4.2 边缘分布

**定义 4.2.1**（边缘分布函数）
$$F_X(x) = \lim_{y \to \infty} F_{X,Y}(x,y)$$

**定义 4.2.2**（边缘密度函数）
$$f_X(x) = \int_{-\infty}^{\infty} f_{X,Y}(x,y) \, dy$$

### 4.3 条件分布

**定义 4.3.1**（条件密度函数）
$$f_{X|Y}(x|y) = \frac{f_{X,Y}(x,y)}{f_Y(y)}$$

**定义 4.3.2**（条件期望）
$$E[X|Y = y] = \int_{-\infty}^{\infty} x f_{X|Y}(x|y) \, dx$$

### 4.4 多元正态分布

**定义 4.4.1**（多元正态分布）
随机向量 $\mathbf{X} = (X_1, \ldots, X_n)^T$ 服从多元正态分布，如果：
$$
f_{\mathbf{X}}(\mathbf{x}) = \frac{1}{(2\pi)^{n/2} |\Sigma|^{1/2}} e^{-\frac{1}{2}(\mathbf{x}-\boldsymbol{\mu})^T \Sigma^{-1} (\mathbf{x}-\boldsymbol{\mu})}
$$

其中 $\boldsymbol{\mu}$ 是均值向量，$\Sigma$ 是协方差矩阵。

## 5. 分布变换

### 5.1 线性变换

**定理 5.1.1**（线性变换）
如果 $X$ 是随机变量，$Y = aX + b$，则：
$$f_Y(y) = \frac{1}{|a|} f_X\left(\frac{y-b}{a}\right)$$

### 5.2 单调变换

**定理 5.2.1**（单调变换）
如果 $X$ 是连续随机变量，$Y = g(X)$ 是严格单调函数，则：
$$f_Y(y) = f_X(g^{-1}(y)) \left|\frac{d}{dy} g^{-1}(y)\right|$$

### 5.3 卷积

**定义 5.3.1**（卷积）
如果 $X, Y$ 是独立连续随机变量，则 $Z = X + Y$ 的密度函数为：
$$f_Z(z) = \int_{-\infty}^{\infty} f_X(x) f_Y(z-x) \, dx$$

## 6. 极限定理

### 6.1 大数定律

**定理 6.1.1**（弱大数定律）
设 $X_1, X_2, \ldots$ 是独立同分布的随机变量，$E[X_i] = \mu$，则：
$$\frac{X_1 + \cdots + X_n}{n} \xrightarrow{P} \mu$$

**定理 6.1.2**（强大数定律）
在相同条件下：
$$\frac{X_1 + \cdots + X_n}{n} \xrightarrow{a.s.} \mu$$

### 6.2 中心极限定理

**定理 6.2.1**（中心极限定理）
设 $X_1, X_2, \ldots$ 是独立同分布的随机变量，$E[X_i] = \mu$，$\text{Var}(X_i) = \sigma^2$，则：
$$\frac{X_1 + \cdots + X_n - n\mu}{\sqrt{n}\sigma} \xrightarrow{d} N(0,1)$$

## 7. 形式化实现

### 7.1 Haskell实现

```haskell
-- 随机变量与分布模块
module RandomVariables where

import Data.List (nub, sort)
import System.Random (Random, randomR, mkStdGen)
import qualified Data.Map as Map

-- 离散分布
data DiscreteDistribution = DiscreteDistribution {
    values :: [Double],
    probabilities :: [Double]
} deriving (Show, Eq)

-- 连续分布
data ContinuousDistribution = ContinuousDistribution {
    density :: Double -> Double,
    support :: (Double, Double),
    cdf :: Double -> Double
} deriving Show

-- 创建伯努利分布
bernoulli :: Double -> DiscreteDistribution
bernoulli p = DiscreteDistribution {
    values = [0, 1],
    probabilities = [1-p, p]
}

-- 创建二项分布
binomial :: Int -> Double -> DiscreteDistribution
binomial n p = DiscreteDistribution {
    values = [0..fromIntegral n],
    probabilities = map (\k -> choose n k * p^k * (1-p)^(n-k)) [0..n]
}
  where
    choose n k = product [n-k+1..n] / product [1..k]

-- 创建泊松分布
poisson :: Double -> DiscreteDistribution
poisson lambda = DiscreteDistribution {
    values = [0..20], -- 截断到20
    probabilities = map (\k -> lambda^k * exp(-lambda) / factorial k) [0..20]
}
  where
    factorial n = product [1..n]

-- 创建均匀分布
uniform :: Double -> Double -> ContinuousDistribution
uniform a b = ContinuousDistribution {
    density = \x -> if x >= a && x <= b then 1/(b-a) else 0,
    support = (a, b),
    cdf = \x -> if x < a then 0 else if x > b then 1 else (x-a)/(b-a)
}

-- 创建正态分布
normal :: Double -> Double -> ContinuousDistribution
normal mu sigma = ContinuousDistribution {
    density = \x -> exp(-(x-mu)^2/(2*sigma^2)) / (sigma * sqrt(2*pi)),
    support = (-infinity, infinity),
    cdf = \x -> 0.5 * (1 + erf((x-mu)/(sigma*sqrt(2))))
}
  where
    infinity = 1e10
    erf x = 2/sqrt(pi) * sum [(-1)^n * x^(2*n+1) / (factorial n * (2*n+1)) | n <- [0..10]]
    factorial n = product [1..n]

-- 期望计算
expectation :: DiscreteDistribution -> Double
expectation dist = sum $ zipWith (*) (values dist) (probabilities dist)

-- 方差计算
variance :: DiscreteDistribution -> Double
variance dist = let
    mu = expectation dist
    in sum $ zipWith (\x p -> p * (x - mu)^2) (values dist) (probabilities dist)

-- 生成随机数
generateDiscrete :: DiscreteDistribution -> IO Double
generateDiscrete dist = do
    let cumulative = scanl1 (+) (probabilities dist)
    r <- randomR (0, 1) <$> mkStdGen <$> randomIO
    return $ selectValue r (zip (values dist) cumulative)
  where
    selectValue r ((v, _):[]) = v
    selectValue r ((v, c):rest) = if r <= c then v else selectValue r rest

-- 测试函数
testDistributions :: IO ()
testDistributions = do
    putStrLn "随机变量与分布测试："

    -- 测试伯努利分布
    let bern = bernoulli 0.3
    putStrLn $ "伯努利分布期望: " ++ show (expectation bern)
    putStrLn $ "伯努利分布方差: " ++ show (variance bern)

    -- 测试二项分布
    let binom = binomial 10 0.5
    putStrLn $ "二项分布期望: " ++ show (expectation binom)
    putStrLn $ "二项分布方差: " ++ show (variance binom)

    -- 测试泊松分布
    let pois = poisson 5.0
    putStrLn $ "泊松分布期望: " ++ show (expectation pois)
    putStrLn $ "泊松分布方差: " ++ show (variance pois)
```

### 7.2 Rust实现

```rust
use std::collections::HashMap;
use rand::Rng;

// 离散分布
# [derive(Clone, Debug)]
struct DiscreteDistribution {
    values: Vec<f64>,
    probabilities: Vec<f64>,
}

// 连续分布
# [derive(Clone, Debug)]
struct ContinuousDistribution {
    density: Box<dyn Fn(f64) -> f64>,
    support: (f64, f64),
    cdf: Box<dyn Fn(f64) -> f64>,
}

impl DiscreteDistribution {
    fn bernoulli(p: f64) -> Self {
        Self {
            values: vec![0.0, 1.0],
            probabilities: vec![1.0 - p, p],
        }
    }

    fn binomial(n: usize, p: f64) -> Self {
        let values: Vec<f64> = (0..=n).map(|x| x as f64).collect();
        let probabilities: Vec<f64> = (0..=n)
            .map(|k| Self::choose(n, k) as f64 * p.powi(k as i32) * (1.0 - p).powi((n - k) as i32))
            .collect();
        Self { values, probabilities }
    }

    fn poisson(lambda: f64) -> Self {
        let values: Vec<f64> = (0..=20).map(|x| x as f64).collect();
        let probabilities: Vec<f64> = (0..=20)
            .map(|k| lambda.powi(k as i32) * (-lambda).exp() / Self::factorial(k) as f64)
            .collect();
        Self { values, probabilities }
    }

    fn expectation(&self) -> f64 {
        self.values.iter()
            .zip(&self.probabilities)
            .map(|(x, p)| x * p)
            .sum()
    }

    fn variance(&self) -> f64 {
        let mu = self.expectation();
        self.values.iter()
            .zip(&self.probabilities)
            .map(|(x, p)| p * (x - mu).powi(2))
            .sum()
    }

    fn choose(n: usize, k: usize) -> usize {
        if k > n { return 0; }
        if k > n - k { return Self::choose(n, n - k); }
        let mut result = 1;
        for i in 0..k {
            result = result * (n - i) / (i + 1);
        }
        result
    }

    fn factorial(n: usize) -> usize {
        (1..=n).product()
    }
}

impl ContinuousDistribution {
    fn uniform(a: f64, b: f64) -> Self {
        Self {
            density: Box::new(move |x| {
                if x >= a && x <= b { 1.0 / (b - a) } else { 0.0 }
            }),
            support: (a, b),
            cdf: Box::new(move |x| {
                if x < a { 0.0 } else if x > b { 1.0 } else { (x - a) / (b - a) }
            }),
        }
    }

    fn normal(mu: f64, sigma: f64) -> Self {
        Self {
            density: Box::new(move |x| {
                (-0.5 * ((x - mu) / sigma).powi(2)).exp() / (sigma * (2.0 * std::f64::consts::PI).sqrt())
            }),
            support: (-f64::INFINITY, f64::INFINITY),
            cdf: Box::new(move |x| {
                0.5 * (1.0 + Self::erf((x - mu) / (sigma * 2.0_f64.sqrt())))
            }),
        }
    }

    fn erf(x: f64) -> f64 {
        // 简化的误差函数近似
        let a1 = 0.254829592;
        let a2 = -0.284496736;
        let a3 = 1.421413741;
        let a4 = -1.453152027;
        let a5 = 1.061405429;
        let p = 0.3275911;

        let sign = if x < 0.0 { -1.0 } else { 1.0 };
        let x = x.abs();

        let t = 1.0 / (1.0 + p * x);
        let y = 1.0 - (((((a5 * t + a4) * t) + a3) * t + a2) * t + a1) * t * (-x * x).exp();

        sign * y
    }
}

// 测试函数
fn test_distributions() {
    println!("随机变量与分布测试：");

    // 测试伯努利分布
    let bern = DiscreteDistribution::bernoulli(0.3);
    println!("伯努利分布期望: {}", bern.expectation());
    println!("伯努利分布方差: {}", bern.variance());

    // 测试二项分布
    let binom = DiscreteDistribution::binomial(10, 0.5);
    println!("二项分布期望: {}", binom.expectation());
    println!("二项分布方差: {}", binom.variance());

    // 测试泊松分布
    let pois = DiscreteDistribution::poisson(5.0);
    println!("泊松分布期望: {}", pois.expectation());
    println!("泊松分布方差: {}", pois.variance());

    // 测试连续分布
    let uniform = ContinuousDistribution::uniform(0.0, 1.0);
    let normal = ContinuousDistribution::normal(0.0, 1.0);

    println!("均匀分布密度 f(0.5): {}", (uniform.density)(0.5));
    println!("正态分布密度 f(0): {}", (normal.density)(0.0));
}

fn main() {
    test_distributions();
}
```

## 8. 习题与练习

### 8.1 基础练习

**练习 8.1.1**
计算以下分布的期望和方差：

1. 伯努利分布 $B(p)$
2. 二项分布 $B(n,p)$
3. 泊松分布 $P(\lambda)$

**练习 8.1.2**
验证以下分布的性质：

1. 正态分布的线性变换
2. 指数分布的无记忆性
3. 伽马分布的可加性

**练习 8.1.3**
计算以下概率：

1. $X \sim N(0,1)$，$P(X > 1.96)$
2. $X \sim \text{Exp}(2)$，$P(X > 1)$
3. $X \sim B(10, 0.3)$，$P(X \geq 5)$

### 8.2 中级练习

**练习 8.2.1**
研究以下问题：

1. 证明中心极限定理
2. 研究分布的收敛性
3. 计算多元正态分布的边缘分布

**练习 8.2.2**
实现以下算法：

1. 随机数生成算法
2. 分布变换算法
3. 多元分布采样算法

**练习 8.2.3**
研究以下应用：

1. 分布在实际问题中的应用
2. 分布拟合和检验
3. 分布参数估计

### 8.3 高级练习

**练习 8.3.1**
研究以下理论问题：

1. 分布的特征函数
2. 分布的矩母函数
3. 分布的熵和信息量

**练习 8.3.2**
实现以下高级算法：

1. 马尔可夫链蒙特卡洛
2. 变分推断
3. 期望最大化算法

**练习 8.3.3**
研究以下应用问题：

1. 分布在高维数据分析中的应用
2. 分布在机器学习中的应用
3. 分布在金融建模中的应用

## 9. 参考文献

1. **Feller, W.** (1968). *An Introduction to Probability Theory and Its Applications*. Wiley.

2. **Casella, G., Berger, R. L.** (2002). *Statistical Inference*. Duxbury.

3. **Ross, S. M.** (2014). *A First Course in Probability*. Pearson.

4. **Grimmett, G., Stirzaker, D.** (2001). *Probability and Random Processes*. Oxford University Press.

5. **Durrett, R.** (2019). *Probability: Theory and Examples*. Cambridge University Press.

6. **Sheldon, M. R.** (2014). *Introduction to Probability Models*. Academic Press.

7. **Johnson, N. L., Kotz, S., Balakrishnan, N.** (1994). *Continuous Univariate Distributions*. Wiley.

8. **Johnson, N. L., Kotz, S., Kemp, A. W.** (1992). *Univariate Discrete Distributions*. Wiley.

---

> **文档信息**
>
> - **创建时间**：2024年12月19日
> - **最后更新**：2024年12月19日
> - **版本**：1.0
> - **状态**：已完成
> - **下一步**：创建 03-大数定律与中心极限定理.md
