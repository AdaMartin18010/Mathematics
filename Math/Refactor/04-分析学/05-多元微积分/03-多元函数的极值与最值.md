# 03-多元函数的极值与最值

在单变量微积分中，我们利用导数来寻找函数的极大值和极小值。现在，我们将这一重要应用推广到多变量函数。这在科学、工程、经济学等领域中至关重要，因为"最优化"（即找到最大或最小值）是许多问题的核心。

## 1. 无约束极值 (Unconstrained Extrema)

我们首先考虑在函数的整个定义域内寻找极值，不受任何额外条件的限制。

**定义 (局部极值)**:

- 如果在一个点 $(x_0, y_0)$ 的某个邻域内，对所有的点 $(x,y)$ 都有 $f(x,y) \le f(x_0, y_0)$，则称 $f(x_0, y_0)$ 是一个**局部极大值 (local maximum)**。
- 如果在一个点 $(x_0, y_0)$ 的某个邻域内，对所有的点 $(x,y)$ 都有 $f(x,y) \ge f(x_0, y_0)$，则称 $f(x_0, y_0)$ 是一个**局部极小值 (local minimum)**。

**极值的必要条件 (一阶条件)**:
如果函数 $f(x,y)$ 在点 $(x_0, y_0)$ 处具有偏导数，并且在该点取得局部极值，那么该点的所有偏导数都必须为零。
$\frac{\partial f}{\partial x}(x_0, y_0) = 0 \quad \text{and} \quad \frac{\partial f}{\partial y}(x_0, y_0) = 0$
用梯度的语言来说，就是 $\nabla f(x_0, y_0) = \mathbf{0}$。

- **几何意义**: 在极值点，函数的切平面必须是水平的。
- **临界点 (Critical Point)**: 我们将所有偏导数都为零的点，或至少有一个偏导数不存在的点，称为**临界点**。极值点必定是临界点，但反之不成立。

**极值的充分条件 (二阶判别法)**:
如何判断一个临界点是极大值、极小值，还是一个既非极大也非极小值的**鞍点 (Saddle Point)**？这需要借助二阶偏导数。

令 $(x_0, y_0)$ 是一个临界点，并构造一个判别式（它本质上是**海森矩阵 (Hessian Matrix)** 的行列式）：
$D(x,y) = \det\begin{pmatrix} f_{xx} & f_{xy} \\ f_{yx} & f_{yy} \end{pmatrix} = f_{xx}f_{yy} - (f_{xy})^2$

在临界点 $(x_0, y_0)$ 处计算 $D = D(x_0, y_0)$ 和 $f_{xx} = f_{xx}(x_0, y_0)$：

1. 如果 $D > 0$ 且 $f_{xx} > 0$，则 $f(x_0, y_0)$ 是一个**局部极小值** (像一个开口向上的碗)。
2. 如果 $D > 0$ 且 $f_{xx} < 0$，则 $f(x_0, y_0)$ 是一个**局部极大值** (像一个开口向下的碗)。
3. 如果 $D < 0$，则 $f(x_0, y_0)$ 是一个**鞍点** (在一个方向上是极大值，在另一个方向上是极小值，形如马鞍)。
4. 如果 $D = 0$，则**判别法失效**，需要使用其他更高阶的方法。

## 2. 有界闭集上的最值

**极值定理的推广**:
如果函数 $f$ 在一个**有界闭集** $D$ 上是**连续**的，那么 $f$ 在 $D$ 上必然能取得其**最大值 (absolute maximum)** 和**最小值 (absolute minimum)**。

**求解步骤**:

1. **内部临界点**: 找出 $f$ 在区域 $D$ 内部的所有临界点，并计算这些点的函数值。
2. **边界最值**: 找出 $f$ 在区域 $D$ 的**边界**上的最大值和最小值。这通常需要将边界参数化，把问题转化为一个或多个单变量函数的求最值问题。
3. **比较**: 比较第一步和第二步中得到的所有值，其中最大的就是全局最大值，最小的就是全局最小值。

## 3. 条件极值与拉格朗日乘数法 (Constrained Extrema and Lagrange Multipliers)

很多实际优化问题都带有约束。例如，在预算有限（约束条件）的情况下，如何实现利润最大化（目标函数）？

**问题描述**:
求函数 $f(x,y,z)$ 在约束条件 $g(x,y,z) = k$ 下的极值。

**核心思想 (几何直观)**:
想象一下目标函数 $f$ 的等高线（或等值面）和约束条件 $g=k$ 所表示的曲线（或曲面）。当我们在约束曲线上移动时，函数 $f$ 的值不断变化。当 $f$ 达到其在约束条件下的极值时，我们必然无法再沿着约束曲线移动来让 $f$ 的值变得更大（或更小）。
这意味着，在这一点，我们前进的方向（约束曲线的切线方向）必须与 $f$ 值变化最快的方向（梯度 $\nabla f$ 的方向）**正交**。
同时，约束曲线本身也始终与其自身的梯度 $\nabla g$ 正交。
因此，在极值点，$\nabla f$ 和 $\nabla g$ 这两个向量必然是**平行**的！

**拉格朗日乘数法**:
两个向量平行，意味着其中一个可以表示为另一个的标量倍数。即：
$\nabla f(x,y,z) = \lambda \nabla g(x,y,z)$
其中，$\lambda$ 是一个标量，称为**拉格朗日乘子 (Lagrange multiplier)**。

**求解步骤**:

1. **构造拉格朗日函数** (一种辅助函数，非必需但方便记忆):
    $L(x,y,z,\lambda) = f(x,y,z) - \lambda(g(x,y,z) - k)$
2. **联立方程组**: 对 $L$ 的所有变量（包括 $\lambda$）求偏导，并令它们为零：
    - $\nabla f = \lambda \nabla g \quad \implies \quad f_x = \lambda g_x, \quad f_y = \lambda g_y, \quad f_z = \lambda g_z$
    - $g(x,y,z) = k$ (原约束条件)
3. **求解**: 解这个方程组，得到所有可能的极值点 $(x,y,z)$。
4. **评估**: 将这些候选点代入原函数 $f$ 中，比较大小以确定最大值和最小值。

这个方法可以自然地推广到多个约束条件的情形。拉格朗日乘数法是现代优化理论的基石，应用极其广泛。
