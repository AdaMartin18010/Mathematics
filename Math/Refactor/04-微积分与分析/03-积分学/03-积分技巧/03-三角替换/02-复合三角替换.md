# 复合三角替换

## 目录

1. [基本概念](#基本概念)
2. [二次函数替换](#二次函数替换)
3. [有理函数替换](#有理函数替换)
4. [指数函数替换](#指数函数替换)
5. [对数函数替换](#对数函数替换)
6. [反三角函数替换](#反三角函数替换)
7. [复合根式替换](#复合根式替换)
8. [应用实例](#应用实例)
9. [代码实现](#代码实现)
10. [相关文件](#相关文件)

## 基本概念

### 定义

复合三角替换是基本三角替换的扩展，用于处理更复杂的积分形式，包括二次函数、有理函数、指数函数等与三角函数的复合形式。

### 核心思想

通过巧妙的变量替换和三角恒等式，将复杂的复合函数积分转化为基本三角替换的形式，从而简化计算。

### 基本原理

1. **配方法**：将二次函数化为标准形式
2. **分解法**：将复合函数分解为基本形式
3. **递推法**：利用递推公式处理高次幂
4. **组合法**：结合多种替换技巧

## 二次函数替换

### 基本形式

对于 $\sqrt{ax^2 + bx + c}$ 形式的表达式，通过配方法转化为标准形式。

### 配方法步骤

#### 1. 标准配方法

**定理**：对于二次函数 $ax^2 + bx + c$，可以配成：

$$ax^2 + bx + c = a\left(x + \frac{b}{2a}\right)^2 + \left(c - \frac{b^2}{4a}\right)$$

**证明**：

1. 展开：$a\left(x + \frac{b}{2a}\right)^2 = a\left(x^2 + \frac{b}{a}x + \frac{b^2}{4a^2}\right)$
2. 简化：$= ax^2 + bx + \frac{b^2}{4a}$
3. 调整常数项：$= ax^2 + bx + c - \frac{b^2}{4a} + \frac{b^2}{4a}$
4. 最终形式：$= ax^2 + bx + c$

#### 2. 判别式分析

设 $D = b^2 - 4ac$ 为判别式：

- **$D > 0$**：两个实根，使用正割替换
- **$D = 0$**：重根，使用正切替换
- **$D < 0$**：无实根，使用正切替换

### 应用实例

#### 1. 正判别式情况

**问题**：计算 $\int \frac{dx}{\sqrt{x^2 + 2x - 3}}$

**解法**：

1. 配方法：$x^2 + 2x - 3 = (x + 1)^2 - 4$
2. 设 $u = x + 1$，则 $du = dx$
3. 积分变为：$\int \frac{du}{\sqrt{u^2 - 4}}$
4. 使用正割替换：$u = 2\sec\theta$
5. 结果：$\ln|u + \sqrt{u^2 - 4}| + C = \ln|x + 1 + \sqrt{x^2 + 2x - 3}| + C$

#### 2. 负判别式情况

**问题**：计算 $\int \frac{dx}{\sqrt{x^2 + 2x + 5}}$

**解法**：

1. 配方法：$x^2 + 2x + 5 = (x + 1)^2 + 4$
2. 设 $u = x + 1$，则 $du = dx$
3. 积分变为：$\int \frac{du}{\sqrt{u^2 + 4}}$
4. 使用正切替换：$u = 2\tan\theta$
5. 结果：$\ln|u + \sqrt{u^2 + 4}| + C = \ln|x + 1 + \sqrt{x^2 + 2x + 5}| + C$

#### 3. 零判别式情况

**问题**：计算 $\int \frac{dx}{\sqrt{x^2 + 2x + 1}}$

**解法**：

1. 配方法：$x^2 + 2x + 1 = (x + 1)^2$
2. 设 $u = x + 1$，则 $du = dx$
3. 积分变为：$\int \frac{du}{\sqrt{u^2}} = \int \frac{du}{|u|}$
4. 结果：$\ln|u| + C = \ln|x + 1| + C$

## 有理函数替换

### 基本形式

对于 $\frac{P(x)}{\sqrt{Q(x)}}$ 形式的积分，其中 $P(x)$ 和 $Q(x)$ 都是多项式。

### 处理方法

#### 1. 多项式分解

将 $P(x)$ 分解为基本形式：

$$P(x) = a_nx^n + a_{n-1}x^{n-1} + \cdots + a_1x + a_0$$

#### 2. 逐项积分

对每一项 $\frac{a_kx^k}{\sqrt{Q(x)}}$ 分别进行积分。

#### 3. 递推公式

利用递推公式处理高次幂项。

### 应用实例

#### 1. 线性有理函数

**问题**：计算 $\int \frac{x + 1}{\sqrt{1 - x^2}} dx$

**解法**：

1. 分解：$\frac{x + 1}{\sqrt{1 - x^2}} = \frac{x}{\sqrt{1 - x^2}} + \frac{1}{\sqrt{1 - x^2}}$
2. 第一项：$\int \frac{x}{\sqrt{1 - x^2}} dx = -\sqrt{1 - x^2} + C_1$
3. 第二项：$\int \frac{1}{\sqrt{1 - x^2}} dx = \arcsin x + C_2$
4. 合并结果：$-\sqrt{1 - x^2} + \arcsin x + C$

#### 2. 二次有理函数

**问题**：计算 $\int \frac{x^2 + 2x + 1}{\sqrt{1 - x^2}} dx$

**解法**：

1. 分解：$\frac{x^2 + 2x + 1}{\sqrt{1 - x^2}} = \frac{x^2}{\sqrt{1 - x^2}} + \frac{2x}{\sqrt{1 - x^2}} + \frac{1}{\sqrt{1 - x^2}}$
2. 使用正弦替换：$x = \sin\theta$
3. 逐项积分：
   - $\int \frac{x^2}{\sqrt{1 - x^2}} dx = \int \sin^2\theta d\theta = \frac{\theta}{2} - \frac{\sin(2\theta)}{4} + C$
   - $\int \frac{2x}{\sqrt{1 - x^2}} dx = -2\sqrt{1 - x^2} + C$
   - $\int \frac{1}{\sqrt{1 - x^2}} dx = \arcsin x + C$
4. 合并结果：$\frac{\arcsin x}{2} - \frac{x\sqrt{1 - x^2}}{2} - 2\sqrt{1 - x^2} + \arcsin x + C$

## 指数函数替换

### 基本形式

对于 $e^{ax}\sqrt{b^2 - x^2}$ 形式的表达式。

### 处理方法

#### 1. 先进行三角替换

设 $x = b\sin\theta$，则 $dx = b\cos\theta d\theta$

#### 2. 处理指数函数

$e^{ax} = e^{ab\sin\theta}$

#### 3. 利用欧拉公式

$e^{i\theta} = \cos\theta + i\sin\theta$

### 应用实例

#### 1. 基本指数替换

**问题**：计算 $\int e^x \sqrt{1 - x^2} dx$

**解法**：

1. 设 $x = \sin\theta$，则 $dx = \cos\theta d\theta$
2. 积分变为：$\int e^{\sin\theta} \cos\theta \cdot \cos\theta d\theta = \int e^{\sin\theta} \cos^2\theta d\theta$
3. 使用分部积分：设 $u = e^{\sin\theta}$，$dv = \cos^2\theta d\theta$
4. 结果：$\frac{e^{\sin\theta}\cos\theta}{2} + \frac{e^{\sin\theta}\sin\theta}{2} + C$
5. 回代：$\frac{e^x\sqrt{1 - x^2}}{2} + \frac{e^x x}{2} + C$

#### 2. 复合指数替换

**问题**：计算 $\int e^{2x} \sqrt{4 - x^2} dx$

**解法**：

1. 设 $x = 2\sin\theta$，则 $dx = 2\cos\theta d\theta$
2. 积分变为：$\int e^{4\sin\theta} \cdot 2\cos\theta \cdot 2\cos\theta d\theta = 4\int e^{4\sin\theta} \cos^2\theta d\theta$
3. 使用递推公式或数值方法

## 对数函数替换

### 基本形式

对于 $\ln x \sqrt{a^2 - x^2}$ 形式的表达式。

### 处理方法

#### 1. 先进行三角替换

设 $x = a\sin\theta$，则 $dx = a\cos\theta d\theta$

#### 2. 处理对数函数

$\ln x = \ln(a\sin\theta) = \ln a + \ln(\sin\theta)$

#### 3. 分部积分

利用分部积分处理对数项。

### 应用实例

**问题**：计算 $\int \ln x \sqrt{1 - x^2} dx$

**解法**：

1. 设 $x = \sin\theta$，则 $dx = \cos\theta d\theta$
2. 积分变为：$\int \ln(\sin\theta) \cos\theta \cdot \cos\theta d\theta = \int \ln(\sin\theta) \cos^2\theta d\theta$
3. 使用分部积分：设 $u = \ln(\sin\theta)$，$dv = \cos^2\theta d\theta$
4. 结果：$\frac{\ln(\sin\theta)\sin(2\theta)}{2} - \frac{\theta}{2} + C$
5. 回代：$\frac{\ln x \cdot x\sqrt{1 - x^2}}{2} - \frac{\arcsin x}{2} + C$

## 反三角函数替换

### 基本形式

对于 $\arcsin x \sqrt{1 - x^2}$ 形式的表达式。

### 处理方法

#### 1. 直接替换

设 $x = \sin\theta$，则 $\arcsin x = \theta$

#### 2. 分部积分

利用分部积分处理反三角函数。

### 应用实例

**问题**：计算 $\int \arcsin x \sqrt{1 - x^2} dx$

**解法**：

1. 设 $x = \sin\theta$，则 $dx = \cos\theta d\theta$
2. 积分变为：$\int \theta \cos\theta \cdot \cos\theta d\theta = \int \theta \cos^2\theta d\theta$
3. 使用分部积分：设 $u = \theta$，$dv = \cos^2\theta d\theta$
4. 结果：$\frac{\theta\sin(2\theta)}{2} + \frac{\theta^2}{2} + C$
5. 回代：$\frac{\arcsin x \cdot x\sqrt{1 - x^2}}{2} + \frac{(\arcsin x)^2}{2} + C$

## 复合根式替换

### 基本形式

对于 $\sqrt{\sqrt{a^2 - x^2}}$ 形式的表达式。

### 处理方法

#### 1. 逐层替换

先进行内层替换，再进行外层替换。

#### 2. 参数化处理

引入参数简化表达式。

### 应用实例

**问题**：计算 $\int \sqrt{\sqrt{1 - x^2}} dx$

**解法**：

1. 设 $x = \sin\theta$，则 $dx = \cos\theta d\theta$
2. 积分变为：$\int \sqrt{\cos\theta} \cos\theta d\theta = \int \cos^{3/2}\theta d\theta$
3. 使用递推公式：$\int \cos^n\theta d\theta = \frac{\cos^{n-1}\theta\sin\theta}{n} + \frac{n-1}{n}\int \cos^{n-2}\theta d\theta$
4. 结果：$\frac{2\cos^{1/2}\theta\sin\theta}{3} + \frac{2}{3}\int \cos^{-1/2}\theta d\theta$
5. 回代：$\frac{2(1 - x^2)^{1/4}x}{3} + \frac{2}{3}\int \frac{dx}{(1 - x^2)^{1/4}}$

## 应用实例

### 1. 物理学应用

#### 1.1 振动问题

**问题**：计算非线性振动的周期

$$T = 4\int_0^A \frac{dx}{\sqrt{2g(h-x) + \frac{k}{m}x^2}}$$

**解法**：

1. 配方法：$2g(h-x) + \frac{k}{m}x^2 = \frac{k}{m}\left(x - \frac{mg}{k}\right)^2 + 2gh - \frac{m^2g^2}{k}$
2. 设 $u = x - \frac{mg}{k}$，则 $du = dx$
3. 积分转化为椭圆积分

#### 1.2 电磁学问题

**问题**：计算非均匀电场的电势

$$\phi = \int \frac{\rho(x) dx}{\sqrt{x^2 + a^2}}$$

其中 $\rho(x) = e^{-x^2}$ 是电荷密度。

**解法**：

1. 使用正切替换：$x = a\tan\theta$
2. 积分变为：$\int \frac{e^{-a^2\tan^2\theta} a\sec^2\theta d\theta}{a\sec\theta} = a\int e^{-a^2\tan^2\theta} \sec\theta d\theta$
3. 使用数值方法或特殊函数

### 2. 工程应用

#### 2.1 信号处理

**问题**：计算滤波器的频率响应

$$H(\omega) = \int_{-\infty}^{\infty} h(t) e^{-i\omega t} dt$$

其中 $h(t) = e^{-at^2} \cos(bt)$。

**解法**：

1. 使用欧拉公式：$\cos(bt) = \frac{e^{ibt} + e^{-ibt}}{2}$
2. 积分变为：$\frac{1}{2}\int_{-\infty}^{\infty} e^{-at^2} (e^{i(b-\omega)t} + e^{-i(b+\omega)t}) dt$
3. 使用高斯积分公式

#### 2.2 控制系统

**问题**：计算系统的脉冲响应

$$y(t) = \int_0^t h(\tau) g(t-\tau) d\tau$$

其中 $h(t) = e^{-at}$，$g(t) = \sin(bt)$。

**解法**：

1. 使用卷积定理
2. 积分变为：$\int_0^t e^{-a\tau} \sin(b(t-\tau)) d\tau$
3. 使用三角恒等式和分部积分

### 3. 经济学应用

#### 3.1 金融数学

**问题**：计算期权的期望收益

$$E[\max(S_T - K, 0)] = \int_K^{\infty} (S_T - K) f(S_T) dS_T$$

其中 $f(S_T) = \frac{1}{S_T\sigma\sqrt{2\pi T}}e^{-\frac{(\ln S_T - \mu)^2}{2\sigma^2 T}}$。

**解法**：

1. 设 $z = \frac{\ln S_T - \mu}{\sigma\sqrt{T}}$，则 $dS_T = S_T \sigma\sqrt{T} dz$
2. 积分变为：$\int_{d_2}^{\infty} (S_0 e^{\mu T + \sigma\sqrt{T}z} - K) \frac{1}{\sqrt{2\pi}} e^{-z^2/2} dz$
3. 使用正态分布的性质

#### 3.2 风险计算

**问题**：计算风险价值（VaR）

$$\text{VaR} = \int_{-\infty}^{-z_\alpha} x f(x) dx$$

其中 $f(x) = \frac{1}{\sqrt{2\pi}} e^{-x^2/2}$ 是标准正态分布。

**解法**：

1. 使用正态分布的性质
2. 结果：$-z_\alpha \Phi(-z_\alpha) + \phi(-z_\alpha)$
3. 其中 $\Phi$ 是累积分布函数，$\phi$ 是概率密度函数

## 代码实现

### Rust实现

```rust
use std::f64::consts::PI;

/// 复合三角替换积分计算器
pub struct CompositeTrigonometricSubstitution;

impl CompositeTrigonometricSubstitution {
    /// 二次函数配方法
    pub fn complete_square(a: f64, b: f64, c: f64) -> (f64, f64, f64) {
        let h = -b / (2.0 * a);
        let k = c - (b * b) / (4.0 * a);
        (a, h, k)
    }
    
    /// 判别式计算
    pub fn discriminant(a: f64, b: f64, c: f64) -> f64 {
        b * b - 4.0 * a * c
    }
    
    /// 二次函数积分 ∫dx/√(ax²+bx+c)
    pub fn quadratic_integral(a: f64, b: f64, c: f64, x: f64) -> f64 {
        let (a_coeff, h, k) = Self::complete_square(a, b, c);
        let u = x - h;
        
        if k > 0.0 {
            // 使用正切替换
            let theta = (u / k.sqrt()).atan();
            theta
        } else if k < 0.0 {
            // 使用正割替换
            let theta = (u / (-k).sqrt()).acos();
            theta
        } else {
            // 线性情况
            u.ln()
        }
    }
    
    /// 有理函数积分 ∫(ax+b)/√(cx²+dx+e) dx
    pub fn rational_integral(a: f64, b: f64, c: f64, d: f64, e: f64, x: f64) -> f64 {
        // 分解为基本积分
        let linear_part = a * Self::quadratic_integral(c, d, e, x);
        let constant_part = b * Self::quadratic_integral(c, d, e, x);
        
        linear_part + constant_part
    }
    
    /// 指数函数积分 ∫e^(ax)√(b²-x²) dx
    pub fn exponential_integral(a: f64, b: f64, x: f64) -> f64 {
        if x.abs() > b {
            panic!("Invalid input: |x| must be <= b");
        }
        
        let theta = (x / b).asin();
        let exp_term = (a * b * theta.sin()).exp();
        let cos_term = theta.cos();
        
        exp_term * cos_term / 2.0 + exp_term * theta.sin() / 2.0
    }
    
    /// 对数函数积分 ∫ln(x)√(a²-x²) dx
    pub fn logarithmic_integral(a: f64, x: f64) -> f64 {
        if x.abs() > a {
            panic!("Invalid input: |x| must be <= a");
        }
        
        let theta = (x / a).asin();
        let log_term = (theta.sin()).ln();
        let sin_term = (2.0 * theta).sin();
        
        log_term * sin_term / 2.0 - theta / 2.0
    }
    
    /// 反三角函数积分 ∫arcsin(x)√(1-x²) dx
    pub fn inverse_trigonometric_integral(x: f64) -> f64 {
        if x.abs() > 1.0 {
            panic!("Invalid input: |x| must be <= 1");
        }
        
        let theta = x.asin();
        let sin_term = (2.0 * theta).sin();
        
        theta * sin_term / 2.0 + theta * theta / 2.0
    }
}

#[cfg(test)]
mod tests {
    use super::*;
    
    #[test]
    fn test_complete_square() {
        let (a, h, k) = CompositeTrigonometricSubstitution::complete_square(1.0, 2.0, 1.0);
        assert!((h - (-1.0)).abs() < 1e-10);
        assert!((k - 0.0).abs() < 1e-10);
    }
    
    #[test]
    fn test_discriminant() {
        let d = CompositeTrigonometricSubstitution::discriminant(1.0, 2.0, 1.0);
        assert!((d - 0.0).abs() < 1e-10);
    }
    
    #[test]
    fn test_quadratic_integral() {
        let result = CompositeTrigonometricSubstitution::quadratic_integral(1.0, 2.0, 1.0, 0.5);
        assert!(result.is_finite());
    }
    
    #[test]
    fn test_exponential_integral() {
        let result = CompositeTrigonometricSubstitution::exponential_integral(1.0, 1.0, 0.5);
        assert!(result.is_finite());
    }
    
    #[test]
    fn test_logarithmic_integral() {
        let result = CompositeTrigonometricSubstitution::logarithmic_integral(1.0, 0.5);
        assert!(result.is_finite());
    }
    
    #[test]
    fn test_inverse_trigonometric_integral() {
        let result = CompositeTrigonometricSubstitution::inverse_trigonometric_integral(0.5);
        assert!(result.is_finite());
    }
}
```

### Haskell实现

```haskell
module CompositeTrigonometricSubstitution where

import Data.Complex

-- 复合三角替换积分计算器
data CompositeTrigonometricSubstitution = CompositeTrigonometricSubstitution

-- 二次函数配方法
completeSquare :: Double -> Double -> Double -> (Double, Double, Double)
completeSquare a b c = (a, h, k)
  where
    h = -b / (2.0 * a)
    k = c - (b * b) / (4.0 * a)

-- 判别式计算
discriminant :: Double -> Double -> Double -> Double
discriminant a b c = b * b - 4.0 * a * c

-- 二次函数积分 ∫dx/√(ax²+bx+c)
quadraticIntegral :: Double -> Double -> Double -> Double -> Double
quadraticIntegral a b c x = 
    let (a_coeff, h, k) = completeSquare a b c
        u = x - h
    in if k > 0.0
       then atan (u / sqrt k)  -- 使用正切替换
       else if k < 0.0
            then acos (u / sqrt (-k))  -- 使用正割替换
            else log (abs u)  -- 线性情况

-- 有理函数积分 ∫(ax+b)/√(cx²+dx+e) dx
rationalIntegral :: Double -> Double -> Double -> Double -> Double -> Double -> Double
rationalIntegral a b c d e x = 
    let linearPart = a * quadraticIntegral c d e x
        constantPart = b * quadraticIntegral c d e x
    in linearPart + constantPart

-- 指数函数积分 ∫e^(ax)√(b²-x²) dx
exponentialIntegral :: Double -> Double -> Double -> Double
exponentialIntegral a b x
  | abs x > b = error "Invalid input: |x| must be <= b"
  | otherwise = 
      let theta = asin (x / b)
          expTerm = exp (a * b * sin theta)
          cosTerm = cos theta
      in expTerm * cosTerm / 2.0 + expTerm * sin theta / 2.0

-- 对数函数积分 ∫ln(x)√(a²-x²) dx
logarithmicIntegral :: Double -> Double -> Double
logarithmicIntegral a x
  | abs x > a = error "Invalid input: |x| must be <= a"
  | otherwise = 
      let theta = asin (x / a)
          logTerm = log (sin theta)
          sinTerm = sin (2.0 * theta)
      in logTerm * sinTerm / 2.0 - theta / 2.0

-- 反三角函数积分 ∫arcsin(x)√(1-x²) dx
inverseTrigonometricIntegral :: Double -> Double
inverseTrigonometricIntegral x
  | abs x > 1.0 = error "Invalid input: |x| must be <= 1"
  | otherwise = 
      let theta = asin x
          sinTerm = sin (2.0 * theta)
      in theta * sinTerm / 2.0 + theta * theta / 2.0

-- 辅助函数
sqrt :: Double -> Double
sqrt = Prelude.sqrt

log :: Double -> Double
log = Prelude.log

exp :: Double -> Double
exp = Prelude.exp

sin, cos, asin, acos, atan :: Double -> Double
sin = Prelude.sin
cos = Prelude.cos
asin = Prelude.asin
acos = Prelude.acos
atan = Prelude.atan

abs :: Double -> Double
abs = Prelude.abs

-- 测试函数
testCompleteSquare :: Bool
testCompleteSquare = 
    let (a, h, k) = completeSquare 1.0 2.0 1.0
    in abs (h - (-1.0)) < 1e-10 && abs (k - 0.0) < 1e-10

testDiscriminant :: Bool
testDiscriminant = abs (discriminant 1.0 2.0 1.0 - 0.0) < 1e-10

testQuadraticIntegral :: Bool
testQuadraticIntegral = isFinite (quadraticIntegral 1.0 2.0 1.0 0.5)

testExponentialIntegral :: Bool
testExponentialIntegral = isFinite (exponentialIntegral 1.0 1.0 0.5)

testLogarithmicIntegral :: Bool
testLogarithmicIntegral = isFinite (logarithmicIntegral 1.0 0.5)

testInverseTrigonometricIntegral :: Bool
testInverseTrigonometricIntegral = isFinite (inverseTrigonometricIntegral 0.5)

-- 辅助函数
isFinite :: Double -> Bool
isFinite x = not (isNaN x || isInfinite x)

isNaN :: Double -> Bool
isNaN = Prelude.isNaN

isInfinite :: Double -> Bool
isInfinite = Prelude.isInfinite

-- 运行所有测试
runTests :: Bool
runTests = testCompleteSquare && testDiscriminant && testQuadraticIntegral && 
           testExponentialIntegral && testLogarithmicIntegral && testInverseTrigonometricIntegral
```

## 相关文件

- [00-三角替换总览](00-三角替换总览.md)
- [01-基本三角替换](01-基本三角替换.md)
- [03-特殊三角替换](03-特殊三角替换.md)
- [04-双曲函数替换](04-双曲函数替换.md)
- [05-欧拉替换](05-欧拉替换.md)
- [06-万能替换](06-万能替换.md)
- [07-应用实例](07-应用实例.md)
- [00-积分技巧总览](../00-积分技巧总览.md)
- [01-换元积分法](../01-换元积分法/00-换元积分法总览.md)
- [02-分部积分法](../02-分部积分法/00-分部积分法总览.md)
- [04-部分分式分解](../04-部分分式分解/00-部分分式分解总览.md)
- [05-有理函数积分](../05-有理函数积分/00-有理函数积分总览.md) 