# 03-ä¸ªæ€§åŒ–æ¨èç³»ç»Ÿ

## ğŸ“Š ç³»ç»Ÿæ¦‚è¿°

- **ç³»ç»Ÿåç§°**: Refactorä¸ªæ€§åŒ–æ¨èç³»ç»Ÿ
- **æ ¸å¿ƒåŠŸèƒ½**: åŸºäºç”¨æˆ·ç”»åƒä¸ååŒè¿‡æ»¤çš„ä¸ªæ€§åŒ–å†…å®¹æ¨è
- **æŠ€æœ¯æ ˆ**: Python + FastAPI + Matrix Factorization + ANN
- **ç›®æ ‡æŒ‡æ ‡**: æ¨èç‚¹å‡»ç‡ > 15%ï¼ŒTop-K å‘½ä¸­ç‡ > 40%

---

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½è®¾è®¡

### 1. ç”¨æˆ·ç”»åƒæ„å»º

#### 1.1 ç”»åƒç»´åº¦

- **å…´è¶£ä¸»é¢˜**: ä»£æ•°/åˆ†æ/å‡ ä½•/æ‹“æ‰‘/é€»è¾‘/æ•°è®º/è·¨å­¦ç§‘
- **éš¾åº¦åå¥½**: å…¥é—¨/åŸºç¡€/è¿›é˜¶/ç ”ç©¶
- **å­¦ä¹ è¡Œä¸º**: æœç´¢è¯ã€ç‚¹å‡»ã€åœç•™æ—¶é•¿ã€è·³å‡ºç‡
- **è¿›åº¦è½¨è¿¹**: å®Œæˆåº¦ã€è®¿é—®é¡ºåºã€è·¯å¾„é•¿åº¦

#### 1.2 ç”»åƒç”Ÿæˆ

```python
class UserProfiler:
    def __init__(self):
        self.decay_factor = 0.85
    
    def build_profile(self, events):
        profile = {
            'interests': self.aggregate_interests(events),
            'difficulty': self.estimate_difficulty(events),
            'sequence_patterns': self.mine_sequences(events)
        }
        return profile
```

### 2. æ¨èç®—æ³•

#### 2.1 åŸºäºå†…å®¹çš„æ¨èï¼ˆCBï¼‰

- è¯­ä¹‰å‘é‡ï¼šSentenceTransformer æ–‡æ¡£åµŒå…¥
- æ¦‚å¿µæ ‡ç­¾ï¼šçŸ¥è¯†å›¾è°±æ¦‚å¿µä¸å…³ç³»ç‰¹å¾
- åŒ¹é…ç­–ç•¥ï¼šä½™å¼¦ç›¸ä¼¼åº¦ + æ¦‚å¿µè¦†ç›–ç‡åŠ æƒ

```python
class ContentBasedRecommender:
    def recommend(self, query_vec, candidate_matrix, top_k=10):
        scores = cosine_similarity(query_vec, candidate_matrix)
        return np.argsort(-scores)[:top_k]
```

#### 2.2 ååŒè¿‡æ»¤ï¼ˆCFï¼‰

- åŸºäºçŸ©é˜µåˆ†è§£ï¼šALS/BPR
- åŸºäºè¿‘é‚»ï¼šANNï¼ˆFaiss/HNSWï¼‰åŠ é€Ÿç›¸ä¼¼ç”¨æˆ·/å†…å®¹æ£€ç´¢

```python
class MatrixFactorizationCF:
    def __init__(self, num_factors=64):
        self.num_factors = num_factors
    
    def fit(self, R):
        # è®­ç»ƒéšå‘é‡ï¼ˆçœç•¥ï¼‰
        pass
    
    def recommend(self, user_id, top_k=10):
        # è®¡ç®—è¯„åˆ†å¹¶å–Top-Kï¼ˆçœç•¥ï¼‰
        pass
```

#### 2.3 æ··åˆæ¨èï¼ˆHybridï¼‰

- èåˆç­–ç•¥ï¼šçº¿æ€§åŠ æƒ + å­¦ä¹ æ’åºï¼ˆLambdaMART/LightGBMï¼‰
- ç‰¹å¾ï¼šCBç›¸ä¼¼åº¦ã€CFåˆ†æ•°ã€ç‚¹å‡»ç‡ã€åœç•™æ—¶é•¿ã€éš¾åº¦åŒ¹é…åº¦ã€ä¸»é¢˜è¦†ç›–ç‡

```python
class HybridRecommender:
    def __init__(self, cb_model, cf_model, ranker):
        self.cb = cb_model
        self.cf = cf_model
        self.ranker = ranker
    
    def recommend(self, user, query_vec, candidates, top_k=10):
        cb_scores = self.cb.score(query_vec, candidates)
        cf_scores = self.cf.score(user, candidates)
        features = self.build_feature_matrix(cb_scores, cf_scores, candidates)
        ranked = self.ranker.rank(features)
        return ranked[:top_k]
```

### 3. å†·å¯åŠ¨ä¸å¤šæ ·æ€§

#### 3.1 å†·å¯åŠ¨

- æ–°ç”¨æˆ·ï¼šåŸºäºçƒ­é—¨+é—®å·å¼•å¯¼+å‘é‡æ£€ç´¢çš„æœ€è¿‘é‚»å†·å¯åŠ¨
- æ–°å†…å®¹ï¼šåŸºäºå†…å®¹ç‰¹å¾çš„è¿‘é‚»å¬å› + çŸ¥è¯†å›¾è°±é‚»åŸŸæ‰©æ•£

#### 3.2 å¤šæ ·æ€§ä¸æ–°é¢–æ€§

- ç»“æœå»å†—ä½™ï¼šMMR/DPP
- æ–°é¢–æ€§æ§åˆ¶ï¼šåŸºäºå†å²æ›å…‰çš„æƒ©ç½šé¡¹

### 4. åœ¨çº¿æœåŠ¡ä¸åé¦ˆé—­ç¯

#### 4.1 åœ¨çº¿æœåŠ¡

- FastAPI æä¾› `/recommend` `/feedback` `/profile` æ¥å£
- Redis ç¼“å­˜ Top-K å€™é€‰ä¸ç”¨æˆ·ç”»åƒ
- å®šæ—¶ä»»åŠ¡ç¦»çº¿è®­ç»ƒã€åœ¨çº¿çƒ­åŠ è½½

#### 4.2 åé¦ˆå­¦ä¹ 

- ç‚¹å‡»/åœç•™/å®Œæˆåº¦ä½œä¸ºæ­£è´Ÿæ ·æœ¬
- å‘¨æœŸæ€§è®­ç»ƒå­¦ä¹ æ’åºæ¨¡å‹

---

## ğŸ§ª è¯„ä¼°ä¸æŒ‡æ ‡

- **ç¦»çº¿**: Recall@K, NDCG@K, MAP, Coverage
- **åœ¨çº¿**: CTR, CVR, Dwell Time, è·³å‡ºç‡, è·¯å¾„å®Œæˆç‡
- **é²æ£’**: å†·å¯åŠ¨ç”¨æˆ·è¦†ç›–ç‡ã€é•¿å°¾å†…å®¹æ›å…‰ç‡

---

## ğŸ—ï¸ æ¶æ„è®¾è®¡

```text
æ¨èç³»ç»Ÿ/
â”œâ”€â”€ offline/
â”‚   â”œâ”€â”€ dataset_builder.py
â”‚   â”œâ”€â”€ train_cb.py
â”‚   â”œâ”€â”€ train_cf.py
â”‚   â””â”€â”€ train_ranker.py
â”œâ”€â”€ online/
â”‚   â”œâ”€â”€ api.py
â”‚   â”œâ”€â”€ recommender.py
â”‚   â””â”€â”€ cache.py
â”œâ”€â”€ features/
â”‚   â”œâ”€â”€ content_features.py
â”‚   â”œâ”€â”€ graph_features.py
â”‚   â””â”€â”€ behavior_features.py
â””â”€â”€ evaluation/
    â”œâ”€â”€ offline_metrics.py
    â””â”€â”€ ab_testing.py
```

---

## ğŸš€ éƒ¨ç½²ä¸ç›‘æ§

- å®¹å™¨åŒ–ä¸ç°åº¦å‘å¸ƒ
- Prometheus + Grafana ç›‘æ§æŒ‡æ ‡
- A/B å®éªŒæ¡†æ¶ä¸æµé‡åˆ†é…

---

*æœ¬æ–‡æ¡£å®šä¹‰ä¸ªæ€§åŒ–æ¨èç³»ç»Ÿçš„è®¾è®¡ä¸è¯„ä¼°æ–¹æ¡ˆï¼Œæ”¯æ’‘æ™ºèƒ½å¯¼èˆªç³»ç»Ÿçš„ä¸ªæ€§åŒ–åŠŸèƒ½ã€‚*
