# 02-质量评估与评分模型

## 📊 模型概述

- **目标**: 对文档质量进行可量化评估与分级
- **维度**: 内容、结构、引用、格式、数学规范、演化稳定性
- **输出**: 单文档分数、模块分数、全局分数、趋势报告

---

## 🎯 评估维度与指标

### 1. 内容质量（Content）

- 覆盖度、深度、准确性、前沿性、示例与应用

### 2. 结构质量（Structure）

- 标题层级、章节完整性、导航一致性、索引与交叉引用

### 3. 引用质量（Reference）

- 链接可达率、内部引用有效率、引用冗余率

### 4. 格式规范（Format）

- Markdown规范、代码块语言、行长、列表缩进

### 5. 数学规范（Math）

- LaTeX规范、括号平衡、环境闭合、常见错误率

### 6. 演化稳定性（Stability）

- 变更频率、回滚率、问题修复时效

---

## 🧮 评分算法

### 1. 单维评分

```python
def score_dimension(metrics, weights):
    score = 0.0
    for k, v in metrics.items():
        score += weights.get(k, 0) * v
    return max(0.0, min(100.0, score))
```

### 2. 文档总体评分

```python
DEFAULT_WEIGHTS = {
    'content': 0.3,
    'structure': 0.2,
    'reference': 0.15,
    'format': 0.15,
    'math': 0.15,
    'stability': 0.05
}

def aggregate_document_score(dim_scores, weights=DEFAULT_WEIGHTS):
    total = 0.0
    for dim, score in dim_scores.items():
        total += weights.get(dim, 0) * (score / 100.0)
    return round(total * 100, 2)
```

### 3. 模块与全局评分

```python
def aggregate_module_score(doc_scores):
    # 分位加权，惩罚长尾低分
    q10 = np.quantile(doc_scores, 0.1)
    mean = np.mean(doc_scores)
    return round(0.7 * mean + 0.3 * q10, 2)
```

---

## 🚦 分级与阈值

- A+ ≥ 90；A ∈ [85, 90)；A- ∈ [80, 85)
- B+ ∈ [75, 80)；B ∈ [70, 75)；B- ∈ [65, 70)
- C < 65（需修复）

---

## 📈 趋势与预警

### 1. 趋势分析

- 移动平均与季节性分解
- 质量下降斜率阈值预警

### 2. 预警规则

```python
ALERT_RULES = [
    {
        'name': 'global_drop',
        'condition': 'global_score_drop > 5 within 7d',
        'severity': 'high'
    },
    {
        'name': 'math_errors_spike',
        'condition': 'math_error_rate > 0.1',
        'severity': 'medium'
    }
]
```

---

## 🏗️ 实施与集成

- 与检测引擎对接，获取维度指标
- 生成文档/模块/全局的评分与分级
- 输出JSON与可视化报表

---

*本文档定义质量评估与评分模型，支撑质量监控系统的量化分析能力。*
