# æ‰©æ•£æ¨¡å‹æ•°å­¦åŸºç¡€ (Diffusion Models: Mathematical Foundations)

> **From Noise to Data: The Mathematics of Diffusion Processes**
>
> ä»å™ªå£°åˆ°æ•°æ®ï¼šæ‰©æ•£è¿‡ç¨‹çš„æ•°å­¦

---

## ç›®å½•

- [æ‰©æ•£æ¨¡å‹æ•°å­¦åŸºç¡€ (Diffusion Models: Mathematical Foundations)](#æ‰©æ•£æ¨¡å‹æ•°å­¦åŸºç¡€-diffusion-models-mathematical-foundations)
  - [ç›®å½•](#ç›®å½•)
  - [ğŸ“‹ æ ¸å¿ƒæ€æƒ³](#-æ ¸å¿ƒæ€æƒ³)
  - [1. æ‰©æ•£è¿‡ç¨‹åŸºç¡€](#1-æ‰©æ•£è¿‡ç¨‹åŸºç¡€)
    - [1.1 å‰å‘æ‰©æ•£è¿‡ç¨‹](#11-å‰å‘æ‰©æ•£è¿‡ç¨‹)
    - [1.2 åå‘å»å™ªè¿‡ç¨‹](#12-åå‘å»å™ªè¿‡ç¨‹)
    - [1.3 å˜åˆ†ä¸‹ç•Œ](#13-å˜åˆ†ä¸‹ç•Œ)
  - [2. éšæœºå¾®åˆ†æ–¹ç¨‹è§†è§’](#2-éšæœºå¾®åˆ†æ–¹ç¨‹è§†è§’)
    - [2.1 å‰å‘SDE](#21-å‰å‘sde)
    - [2.2 åå‘SDE](#22-åå‘sde)
    - [2.3 æ¦‚ç‡æµODE](#23-æ¦‚ç‡æµode)
  - [3. åˆ†æ•°åŒ¹é…](#3-åˆ†æ•°åŒ¹é…)
    - [3.1 åˆ†æ•°å‡½æ•°](#31-åˆ†æ•°å‡½æ•°)
    - [3.2 åˆ†æ•°åŒ¹é…ç›®æ ‡](#32-åˆ†æ•°åŒ¹é…ç›®æ ‡)
    - [3.3 å»å™ªåˆ†æ•°åŒ¹é…](#33-å»å™ªåˆ†æ•°åŒ¹é…)
  - [4. DDPMç®—æ³•](#4-ddpmç®—æ³•)
    - [4.1 å‰å‘è¿‡ç¨‹](#41-å‰å‘è¿‡ç¨‹)
    - [4.2 åå‘è¿‡ç¨‹](#42-åå‘è¿‡ç¨‹)
    - [4.3 è®­ç»ƒç›®æ ‡](#43-è®­ç»ƒç›®æ ‡)
  - [5. é‡‡æ ·æ–¹æ³•](#5-é‡‡æ ·æ–¹æ³•)
    - [5.1 DDPMé‡‡æ ·](#51-ddpmé‡‡æ ·)
    - [5.2 DDIMé‡‡æ ·](#52-ddimé‡‡æ ·)
    - [5.3 åŠ é€Ÿé‡‡æ ·](#53-åŠ é€Ÿé‡‡æ ·)
  - [6. æ¡ä»¶ç”Ÿæˆ](#6-æ¡ä»¶ç”Ÿæˆ)
    - [6.1 åˆ†ç±»å™¨å¼•å¯¼](#61-åˆ†ç±»å™¨å¼•å¯¼)
    - [6.2 åˆ†ç±»å™¨æ— å…³å¼•å¯¼](#62-åˆ†ç±»å™¨æ— å…³å¼•å¯¼)
  - [7. æµåŒ¹é… (Flow Matching)](#7-æµåŒ¹é…-flow-matching)
    - [7.1 è¿ç»­å½’ä¸€åŒ–æµ](#71-è¿ç»­å½’ä¸€åŒ–æµ)
    - [7.2 æµåŒ¹é…ç›®æ ‡](#72-æµåŒ¹é…ç›®æ ‡)
  - [8. å½¢å¼åŒ–å®šä¹‰ (Lean)](#8-å½¢å¼åŒ–å®šä¹‰-lean)
  - [9. ä¹ é¢˜](#9-ä¹ é¢˜)
  - [10. å‚è€ƒèµ„æ–™](#10-å‚è€ƒèµ„æ–™)

---

## ğŸ“‹ æ ¸å¿ƒæ€æƒ³

**æ‰©æ•£æ¨¡å‹**é€šè¿‡é€æ­¥å»å™ªè¿‡ç¨‹ç”Ÿæˆæ•°æ®ï¼Œå°†æ•°æ®åˆ†å¸ƒè½¬åŒ–ä¸ºç®€å•å™ªå£°åˆ†å¸ƒã€‚

**ä¸ºä»€ä¹ˆæ‰©æ•£æ¨¡å‹é‡è¦**:

```text
æ ¸å¿ƒé—®é¢˜:
â”œâ”€ å¦‚ä½•ä»ç®€å•åˆ†å¸ƒç”Ÿæˆå¤æ‚æ•°æ®ï¼Ÿ
â”œâ”€ å¦‚ä½•è®¾è®¡å¯è®­ç»ƒçš„ç”Ÿæˆè¿‡ç¨‹ï¼Ÿ
â”œâ”€ å¦‚ä½•ä¿è¯ç”Ÿæˆè´¨é‡ï¼Ÿ
â””â”€ å¦‚ä½•åŠ é€Ÿé‡‡æ ·ï¼Ÿ

ç†è®ºå·¥å…·:
â”œâ”€ éšæœºå¾®åˆ†æ–¹ç¨‹: è¿ç»­æ—¶é—´æ‰©æ•£
â”œâ”€ åˆ†æ•°åŒ¹é…: å­¦ä¹ æ•°æ®åˆ†å¸ƒ
â”œâ”€ å˜åˆ†æ¨æ–­: ä¼˜åŒ–ç”Ÿæˆè¿‡ç¨‹
â””â”€ æµåŒ¹é…: ç¡®å®šæ€§ç”Ÿæˆ

å®è·µåº”ç”¨:
â”œâ”€ å›¾åƒç”Ÿæˆ: DALLÂ·E 2, Stable Diffusion
â”œâ”€ æ–‡æœ¬ç”Ÿæˆ: æ‰©æ•£è¯­è¨€æ¨¡å‹
â”œâ”€ éŸ³é¢‘ç”Ÿæˆ: éŸ³ä¹ã€è¯­éŸ³åˆæˆ
â””â”€ 3Dç”Ÿæˆ: ç‚¹äº‘ã€ç½‘æ ¼ç”Ÿæˆ
```

---

## 1. æ‰©æ•£è¿‡ç¨‹åŸºç¡€

### 1.1 å‰å‘æ‰©æ•£è¿‡ç¨‹

**å‰å‘è¿‡ç¨‹**: é€æ­¥å‘æ•°æ®æ·»åŠ å™ªå£°ï¼Œç›´åˆ°å˜æˆçº¯å™ªå£°ã€‚

**å®šä¹‰ 1.1** (å‰å‘æ‰©æ•£)
ç»™å®šæ•°æ® \( x_0 \sim q(x_0) \)ï¼Œå‰å‘æ‰©æ•£è¿‡ç¨‹å®šä¹‰ä¸ºï¼š
\[
q(x_t \mid x_{t-1}) = \mathcal{N}(x_t; \sqrt{1-\beta_t} x_{t-1}, \beta_t I)
\]

å…¶ä¸­ \( \beta_t \in (0, 1) \) æ˜¯å™ªå£°è°ƒåº¦ã€‚

**æ€§è´¨**: å¯ä»¥ç›´æ¥é‡‡æ ·ä»»æ„æ—¶åˆ»ï¼š
\[
q(x_t \mid x_0) = \mathcal{N}(x_t; \sqrt{\bar{\alpha}_t} x_0, (1-\bar{\alpha}_t) I)
\]

å…¶ä¸­ \( \bar{\alpha}_t = \prod_{s=1}^t (1-\beta_s) \)ã€‚

### 1.2 åå‘å»å™ªè¿‡ç¨‹

**åå‘è¿‡ç¨‹**: ä»å™ªå£°é€æ­¥å»å™ªï¼Œæ¢å¤æ•°æ®ã€‚

**å®šä¹‰ 1.2** (åå‘è¿‡ç¨‹)
åå‘å»å™ªè¿‡ç¨‹å®šä¹‰ä¸ºï¼š
\[
p_\theta(x_{t-1} \mid x_t) = \mathcal{N}(x_{t-1}; \mu_\theta(x_t, t), \Sigma_\theta(x_t, t))
\]

**ç›®æ ‡**: å­¦ä¹  \( p_\theta \) ä½¿å¾— \( p_\theta(x_0) \approx q(x_0) \)ã€‚

### 1.3 å˜åˆ†ä¸‹ç•Œ

**å˜åˆ†ä¸‹ç•Œ (ELBO)**:
\[
\log p_\theta(x_0) \geq \mathbb{E}_q\left[\log \frac{p_\theta(x_{0:T})}{q(x_{1:T} \mid x_0)}\right]
\]

**åˆ†è§£**:
\[
L = L_T + \sum_{t=2}^T L_{t-1} + L_0
\]

å…¶ä¸­ï¼š
- \( L_T = \text{KL}(q(x_T \mid x_0) \| p(x_T)) \): å…ˆéªŒåŒ¹é…
- \( L_{t-1} = \text{KL}(q(x_{t-1} \mid x_t, x_0) \| p_\theta(x_{t-1} \mid x_t)) \): å»å™ªåŒ¹é…
- \( L_0 = -\log p_\theta(x_0 \mid x_1) \): é‡æ„é¡¹

---

## 2. éšæœºå¾®åˆ†æ–¹ç¨‹è§†è§’

### 2.1 å‰å‘SDE

**å‰å‘SDE** (Song et al., 2021):
\[
dx = f(x, t)dt + g(t)dw
\]

å…¶ä¸­ \( w \) æ˜¯å¸ƒæœ—è¿åŠ¨ã€‚

**ä¾‹**: Variance Preserving (VP) SDE:
\[
dx = -\frac{1}{2}\beta(t)x dt + \sqrt{\beta(t)} dw
\]

### 2.2 åå‘SDE

**åå‘SDE**:
\[
dx = [f(x, t) - g(t)^2 \nabla_x \log p_t(x)]dt + g(t)d\bar{w}
\]

å…¶ä¸­ \( \bar{w} \) æ˜¯åå‘å¸ƒæœ—è¿åŠ¨ï¼Œ\( \nabla_x \log p_t(x) \) æ˜¯åˆ†æ•°å‡½æ•°ã€‚

### 2.3 æ¦‚ç‡æµODE

**æ¦‚ç‡æµODE** (Song et al., 2021):
\[
dx = \left[f(x, t) - \frac{1}{2}g(t)^2 \nabla_x \log p_t(x)\right]dt
\]

**ä¼˜åŠ¿**: ç¡®å®šæ€§é‡‡æ ·ï¼Œå¯é€†ã€‚

---

## 3. åˆ†æ•°åŒ¹é…

### 3.1 åˆ†æ•°å‡½æ•°

**å®šä¹‰ 3.1** (åˆ†æ•°å‡½æ•°)
**åˆ†æ•°å‡½æ•°**å®šä¹‰ä¸ºæ•°æ®åˆ†å¸ƒçš„å¯¹æ•°æ¢¯åº¦ï¼š
\[
s_\theta(x, t) \approx \nabla_x \log p_t(x)
\]

### 3.2 åˆ†æ•°åŒ¹é…ç›®æ ‡

**åˆ†æ•°åŒ¹é…æŸå¤±**:
\[
L = \mathbb{E}_{t, x_0, x_t}\left[\lambda(t) \|s_\theta(x_t, t) - \nabla_{x_t} \log q(x_t \mid x_0)\|^2\right]
\]

### 3.3 å»å™ªåˆ†æ•°åŒ¹é…

**å»å™ªåˆ†æ•°åŒ¹é…** (Vincent, 2011):
\[
L = \mathbb{E}_{t, x_0, \epsilon}\left[\lambda(t) \|s_\theta(x_t, t) + \frac{\epsilon}{\sigma_t}\|^2\right]
\]

å…¶ä¸­ \( x_t = x_0 + \sigma_t \epsilon \)ï¼Œ\( \epsilon \sim \mathcal{N}(0, I) \)ã€‚

---

## 4. DDPMç®—æ³•

### 4.1 å‰å‘è¿‡ç¨‹

**DDPMå‰å‘è¿‡ç¨‹** (Ho et al., 2020):
\[
q(x_t \mid x_{t-1}) = \mathcal{N}(x_t; \sqrt{1-\beta_t} x_{t-1}, \beta_t I)
\]

**çº¿æ€§è°ƒåº¦**: \( \beta_t \) ä» \( \beta_1 = 10^{-4} \) çº¿æ€§å¢åŠ åˆ° \( \beta_T = 0.02 \)ã€‚

### 4.2 åå‘è¿‡ç¨‹

**åå‘è¿‡ç¨‹**:
\[
p_\theta(x_{t-1} \mid x_t) = \mathcal{N}(x_{t-1}; \mu_\theta(x_t, t), \sigma_t^2 I)
\]

**å‡å€¼å‚æ•°åŒ–**:
\[
\mu_\theta(x_t, t) = \frac{1}{\sqrt{\alpha_t}}\left(x_t - \frac{\beta_t}{\sqrt{1-\bar{\alpha}_t}} \epsilon_\theta(x_t, t)\right)
\]

### 4.3 è®­ç»ƒç›®æ ‡

**ç®€åŒ–æŸå¤±**:
\[
L = \mathbb{E}_{t, x_0, \epsilon}\left[\|\epsilon - \epsilon_\theta(\sqrt{\bar{\alpha}_t} x_0 + \sqrt{1-\bar{\alpha}_t} \epsilon, t)\|^2\right]
\]

**è§£é‡Š**: é¢„æµ‹æ·»åŠ åˆ° \( x_0 \) çš„å™ªå£°ã€‚

---

## 5. é‡‡æ ·æ–¹æ³•

### 5.1 DDPMé‡‡æ ·

**DDPMé‡‡æ ·**:
1. é‡‡æ · \( x_T \sim \mathcal{N}(0, I) \)
2. For \( t = T, \ldots, 1 \):
   \[
   x_{t-1} = \frac{1}{\sqrt{\alpha_t}}\left(x_t - \frac{\beta_t}{\sqrt{1-\bar{\alpha}_t}} \epsilon_\theta(x_t, t)\right) + \sigma_t z
   \]
   å…¶ä¸­ \( z \sim \mathcal{N}(0, I) \)

### 5.2 DDIMé‡‡æ ·

**DDIM** (Song et al., 2021): ç¡®å®šæ€§é‡‡æ ·ï¼Œå¯åŠ é€Ÿã€‚

**æ›´æ–°**:
\[
x_{t-1} = \sqrt{\bar{\alpha}_{t-1}} \hat{x}_0 + \sqrt{1-\bar{\alpha}_{t-1}} \epsilon_\theta(x_t, t)
\]

å…¶ä¸­ \( \hat{x}_0 = \frac{x_t - \sqrt{1-\bar{\alpha}_t} \epsilon_\theta(x_t, t)}{\sqrt{\bar{\alpha}_t}} \)ã€‚

### 5.3 åŠ é€Ÿé‡‡æ ·

**æ–¹æ³•**:
- å‡å°‘é‡‡æ ·æ­¥æ•°ï¼ˆå­åºåˆ—é‡‡æ ·ï¼‰
- é«˜é˜¶æ±‚è§£å™¨ï¼ˆRunge-Kuttaï¼‰
- çŸ¥è¯†è’¸é¦

---

## 6. æ¡ä»¶ç”Ÿæˆ

### 6.1 åˆ†ç±»å™¨å¼•å¯¼

**åˆ†ç±»å™¨å¼•å¯¼** (Dhariwal & Nichol, 2021):
\[
\nabla_x \log p(x \mid y) = \nabla_x \log p(x) + s \nabla_x \log p(y \mid x)
\]

å…¶ä¸­ \( s \) æ˜¯å¼•å¯¼å¼ºåº¦ã€‚

### 6.2 åˆ†ç±»å™¨æ— å…³å¼•å¯¼

**CFG** (Ho & Salimans, 2022):
\[
\epsilon_\theta(x_t, t, y) = \epsilon_\theta(x_t, t, \emptyset) + s(\epsilon_\theta(x_t, t, y) - \epsilon_\theta(x_t, t, \emptyset))
\]

**ä¼˜åŠ¿**: ä¸éœ€è¦è®­ç»ƒåˆ†ç±»å™¨ã€‚

---

## 7. æµåŒ¹é… (Flow Matching)

### 7.1 è¿ç»­å½’ä¸€åŒ–æµ

**è¿ç»­å½’ä¸€åŒ–æµ**:
\[
\frac{dx_t}{dt} = v_\theta(x_t, t)
\]

å…¶ä¸­ \( v_\theta \) æ˜¯é€Ÿåº¦åœºã€‚

### 7.2 æµåŒ¹é…ç›®æ ‡

**æµåŒ¹é…æŸå¤±** (Lipman et al., 2022):
\[
L = \mathbb{E}_{t, x_0, x_1}\left[\|v_\theta(x_t, t) - u_t(x_t \mid x_0, x_1)\|^2\right]
\]

å…¶ä¸­ \( u_t \) æ˜¯æ¡ä»¶é€Ÿåº¦åœºã€‚

**ä¼˜åŠ¿**: æ›´å¿«çš„é‡‡æ ·ï¼Œç¡®å®šæ€§ã€‚

---

## 8. å½¢å¼åŒ–å®šä¹‰ (Lean)

```lean
-- å‰å‘æ‰©æ•£
def forward_diffusion (xâ‚€ : â„â¿) (Î² : â„ â†’ â„) (t : â„) : â„â¿ :=
  âˆš(1 - Î² t) * xâ‚€ + âˆš(Î² t) * Îµ where Îµ ~ N(0, I)

-- åå‘å»å™ª
def reverse_denoising (x_t : â„â¿) (Îµ_Î¸ : â„â¿ â†’ â„ â†’ â„â¿) (t : â„) : â„â¿ :=
  (1/âˆšÎ±_t) * (x_t - (Î²_t/âˆš(1-Î±Ì„_t)) * Îµ_Î¸(x_t, t))

-- åˆ†æ•°åŒ¹é…
def score_matching_loss (s_Î¸ : â„â¿ â†’ â„ â†’ â„â¿) : â„ :=
  E_{t,xâ‚€,Îµ} [||s_Î¸(x_t, t) + Îµ/Ïƒ_t||Â²]
```

---

## 9. ä¹ é¢˜

### åŸºç¡€ä¹ é¢˜

1. **å‰å‘è¿‡ç¨‹**:
   æ¨å¯¼ \( q(x_t \mid x_0) \) çš„é—­å¼è§£ã€‚

2. **ELBOåˆ†è§£**:
   æ¨å¯¼æ‰©æ•£æ¨¡å‹çš„ELBOåˆ†è§£ã€‚

3. **DDPMé‡‡æ ·**:
   å®ç°DDPMé‡‡æ ·ç®—æ³•ã€‚

### è¿›é˜¶ä¹ é¢˜

1. **SDEè§†è§’**:
   æ¨å¯¼å‰å‘å’Œåå‘SDEã€‚

2. **æµåŒ¹é…**:
   å®ç°æµåŒ¹é…è®­ç»ƒå’Œé‡‡æ ·ã€‚

3. **æ¡ä»¶ç”Ÿæˆ**:
   å®ç°åˆ†ç±»å™¨æ— å…³å¼•å¯¼ã€‚

---

## 10. å‚è€ƒèµ„æ–™

### æ•™æ

1. **SÃ¤rkkÃ¤, S. & Solin, A.** *Applied Stochastic Differential Equations*. Cambridge University Press, 2019.

### è¯¾ç¨‹

1. **Stanford CS236** - Deep Generative Models
2. **MIT 6.S192** - Deep Learning for Art, Aesthetics, and Creativity

### è®ºæ–‡

1. **Ho, J. et al.** "Denoising Diffusion Probabilistic Models." *NeurIPS*, 2020.
2. **Song, J. et al.** "Score-Based Generative Modeling through Stochastic Differential Equations." *ICLR*, 2021.
3. **Lipman, Y. et al.** "Flow Matching for Generative Modeling." *ICLR*, 2023.
4. **Ho, J. & Salimans, T.** "Classifier-Free Diffusion Guidance." *NeurIPS*, 2022.

---

**æœ€åæ›´æ–°**: 2025-12-20
**å®Œæˆåº¦**: çº¦80% (æ ¸å¿ƒå†…å®¹å®Œæˆï¼Œå¯ç»§ç»­è¡¥å……æ›´å¤šåº”ç”¨å®ä¾‹å’Œå½¢å¼åŒ–è¯æ˜)
